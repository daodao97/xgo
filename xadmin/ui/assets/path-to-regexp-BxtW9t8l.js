var f={};Object.defineProperty(f,"__esModule",{value:!0});f.TokenData=void 0;f.parse=T;var F=f.compile=U;f.match=M;f.pathToRegexp=C;f.stringify=O;const w="/",v=n=>n,D=/^[$_\p{ID_Start}]$/u,E=/^[$\u200c\u200d\p{ID_Continue}]$/u,g="https://git.new/pathToRegexpError",_={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function S(n){return n.replace(/[{}()\[\]+?!:*]/g,"\\$&")}function p(n){return n.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}function*I(n){const t=[...n];let e=0;function o(){let r="";if(D.test(t[++e]))for(r+=t[e];E.test(t[++e]);)r+=t[e];else if(t[e]==='"'){let s=e;for(;e<t.length;){if(t[++e]==='"'){e++,s=0;break}t[e]==="\\"?r+=t[++e]:r+=t[e]}if(s)throw new TypeError(`Unterminated quote at ${s}: ${g}`)}if(!r)throw new TypeError(`Missing parameter name at ${e}: ${g}`);return r}for(;e<t.length;){const r=t[e],s=_[r];if(s)yield{type:s,index:e++,value:r};else if(r==="\\")yield{type:"ESCAPED",index:e++,value:t[e++]};else if(r===":"){const u=o();yield{type:"PARAM",index:e,value:u}}else if(r==="*"){const u=o();yield{type:"WILDCARD",index:e,value:u}}else yield{type:"CHAR",index:e,value:t[e++]}}return{type:"END",index:e,value:""}}class N{constructor(t){this.tokens=t}peek(){if(!this._peek){const t=this.tokens.next();this._peek=t.value}return this._peek}tryConsume(t){const e=this.peek();if(e.type===t)return this._peek=void 0,e.value}consume(t){const e=this.tryConsume(t);if(e!==void 0)return e;const{type:o,index:r}=this.peek();throw new TypeError(`Unexpected ${o} at ${r}, expected ${t}: ${g}`)}text(){let t="",e;for(;e=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=e;return t}}class ${constructor(t){this.tokens=t}}f.TokenData=$;function T(n,t={}){const{encodePath:e=v}=t,o=new N(I(n));function r(u){const i=[];for(;;){const c=o.text();c&&i.push({type:"text",value:e(c)});const a=o.tryConsume("PARAM");if(a){i.push({type:"param",name:a});continue}const h=o.tryConsume("WILDCARD");if(h){i.push({type:"wildcard",name:h});continue}if(o.tryConsume("{")){i.push({type:"group",tokens:r("}")});continue}return o.consume(u),i}}const s=r("END");return new $(s)}function U(n,t={}){const{encode:e=encodeURIComponent,delimiter:o=w}=t,r=n instanceof $?n:T(n,t),s=A(r.tokens,o,e);return function(i={}){const[c,...a]=s(i);if(a.length)throw new TypeError(`Missing parameters: ${a.join(", ")}`);return c}}function A(n,t,e){const o=n.map(r=>P(r,t,e));return r=>{const s=[""];for(const u of o){const[i,...c]=u(r);s[0]+=i,s.push(...c)}return s}}function P(n,t,e){if(n.type==="text")return()=>[n.value];if(n.type==="group"){const r=A(n.tokens,t,e);return s=>{const[u,...i]=r(s);return i.length?[""]:[u]}}const o=e||v;return n.type==="wildcard"&&e!==!1?r=>{const s=r[n.name];if(s==null)return["",n.name];if(!Array.isArray(s)||s.length===0)throw new TypeError(`Expected "${n.name}" to be a non-empty array`);return[s.map((u,i)=>{if(typeof u!="string")throw new TypeError(`Expected "${n.name}/${i}" to be a string`);return o(u)}).join(t)]}:r=>{const s=r[n.name];if(s==null)return["",n.name];if(typeof s!="string")throw new TypeError(`Expected "${n.name}" to be a string`);return[o(s)]}}function M(n,t={}){const{decode:e=decodeURIComponent,delimiter:o=w}=t,{regexp:r,keys:s}=C(n,t),u=s.map(i=>e===!1?v:i.type==="param"?e:c=>c.split(o).map(e));return function(c){const a=r.exec(c);if(!a)return!1;const h=a[0],l=Object.create(null);for(let y=1;y<a.length;y++){if(a[y]===void 0)continue;const m=s[y-1],x=u[y-1];l[m.name]=x(a[y])}return{path:h,params:l}}}function C(n,t={}){const{delimiter:e=w,end:o=!0,sensitive:r=!1,trailing:s=!0}=t,u=[],i=[],c=r?"":"i",h=(Array.isArray(n)?n:[n]).map(m=>m instanceof $?m:T(m,t));for(const{tokens:m}of h)for(const x of d(m,0,[])){const R=j(x,e,u);i.push(R)}let l=`^(?:${i.join("|")})`;return s&&(l+=`(?:${p(e)}$)?`),l+=o?"$":`(?=${p(e)}|$)`,{regexp:new RegExp(l,c),keys:u}}function*d(n,t,e){if(t===n.length)return yield e;const o=n[t];if(o.type==="group"){const r=e.slice();for(const s of d(o.tokens,0,r))yield*d(n,t+1,s)}else e.push(o);yield*d(n,t+1,e)}function j(n,t,e){let o="",r="",s=!0;for(let u=0;u<n.length;u++){const i=n[u];if(i.type==="text"){o+=p(i.value),r+=i.value,s||(s=i.value.includes(t));continue}if(i.type==="param"||i.type==="wildcard"){if(!s&&!r)throw new TypeError(`Missing text after "${i.name}": ${g}`);i.type==="param"?o+=`(${L(t,s?"":r)}+)`:o+="([\\s\\S]+)",e.push(i),r="",s=!1;continue}}return o}function L(n,t){return t.length<2?n.length<2?`[^${p(n+t)}]`:`(?:(?!${p(n)})[^${p(t)}])`:n.length<2?`(?:(?!${p(t)})[^${p(n)}])`:`(?:(?!${p(t)}|${p(n)})[\\s\\S])`}function O(n){return n.tokens.map(function t(e,o,r){if(e.type==="text")return S(e.value);if(e.type==="group")return`{${e.tokens.map(t).join("")}}`;const u=q(e.name)&&b(r[o+1])?e.name:JSON.stringify(e.name);if(e.type==="param")return`:${u}`;if(e.type==="wildcard")return`*${u}`;throw new TypeError(`Unexpected token: ${e}`)}).join("")}function q(n){const[t,...e]=n;return D.test(t)?e.every(o=>E.test(o)):!1}function b(n){return(n==null?void 0:n.type)!=="text"?!0:!E.test(n.value[0])}export{F as c};
