import{l as $}from"./lodash-BdQm9T6w.js";import{c as K,G as Yt,e as F,h as xe,Q as I,m as oe,P as we,z as Gt,V as at,O as Wt,y as Jt,s as X,f as H,X as lt,a as ot,W as Qt,B as qe,u as Ke,L as Ye,F as Xt,H as me,g as ke,i as Zt,K as ea,I as Ge,Y as ta,C as aa,x as la,j as oa,k as sa,l as na,T as We,o as Je,r as Qe}from"./okiss-utils-CR8lRhCD.js";import{I as ra,J as ia,K as ua,L as ie,b as q,m as G,M as st,g as Z,N as da,O as pa,P as Oe,Q as ca,R as ha,S as Be,r as Ae,e as W,T as ma,x as De,q as je,f as ue,w as Te,o as nt,j as fa,k as ba,h as ya,l as rt,U as it,V as ga,F as ut,W as dt,X as pt,Y as ct,Z as va,E as ht,a as Ee,G as wa,_ as ka,$ as Va,a0 as Ca,a1 as $a,a2 as Sa,a3 as mt,d as _a,a4 as xa,a5 as Oa}from"./element-plus-BSSt7pxY.js";import"./vue-Bbxk6eDH.js";import{S as ft,T as Ba,B as Pe,A as bt,l as Aa,j as Da,k as ja,V as yt}from"./element-plus-icons-vue-BSeInZWw.js";import{J as Ta}from"./inputmask-Da6QBhuS.js";import{Q as Ea}from"./vuedraggable-DHES128H.js";import{g as Pa}from"./dayjs-B3Bs8POl.js";import{F as Ia}from"./file-saver-D5JKIZIB.js";import{u as $e,w as Fa,S as La}from"./xlsx-CzFfZwKU.js";import{S as Ma}from"./sortablejs-BDiCfuGh.js";import{R as te,d as B,j as c,c as z,k as p,a as be,e as v,f as r,q as V,v as f,F as T,J as N,o as Ie,x as gt,P as A,G as ye,g as de,l as Q,Q as vt,I as ge,m as M,t as x,h as S,z as wt,i as Na,s as Y,O as kt,r as ee}from"./vue-runtime-core-FXhYHVgh.js";import{r as _,u as L,i as pe,m as Xe,e as Ra,s as Se,d as Ha}from"./vue-reactivity-C_72soeA.js";import{t as O,e as U,n as Fe,g as fe}from"./vue-shared-Bk1_eoCT.js";import{d as Ze,v as Vt,c as Ua}from"./vue-runtime-dom-Cn9-AkrD.js";const za=B({name:"VSelect",inject:["formData","rootData"],props:{options:{type:[Array,Function,Object],default:()=>[]},modelValue:{type:[Array,String,Number],default:void 0},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"},selectApi:{type:[String,Function],default:""},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:0},allowCreate:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},tpl:{type:String,default:""},fullWidth:{type:Boolean,default:!1},effectData:{type:[Object,String],default:()=>{}},immediate:{type:Boolean,default:!1},watch:{type:String,default:""}},emits:["update:modelValue"],data(){return this.$props.watch&&this.$watch(`formData.${this.$props.watch}`,this.onWatch,{deep:!0,immediate:!0}),{loading:!1,localValue:this.$props.modelValue,localOptions:[]}},computed:{filteredOptions(){return this.localOptions?.filter(e=>e.when===void 0?!0:oe(this.formData,e.when))},remote(){return!!this.$props.selectApi},localFilterable(){return this.$props.selectApi?!0:this.$props.filterable},getEffectData(){if(Object.keys(this.effectData||{}).length===0)return{};const e=$.find(this.localOptions,a=>a[this.valueKey]===this.localValue);if(!e)return{};if(this.effectData==="*")return e;const t={};return Object.keys(this.effectData).forEach(a=>{e[a]!==void 0&&(t[a]=e[a])}),t}},beforeMount(){if(this.$props.modelValue&&this.$props.selectApi&&this.search(this.$props.modelValue),this.$props.immediate&&this.$props.selectApi&&this.search(this.$props.modelValue),I(this.$props.options))this.localOptions=this.$props.options;else if(H(this.$props.options)){const e=this.$props.options,t=e();t.then!==void 0?t.then(a=>{this.localOptions=a}):this.localOptions=t}else this.$props.options.then!==void 0&&this.$props.options.then(e=>{this.localOptions=e})},methods:{onWatch(){this.$props.immediate&&this.$props.selectApi&&this.search(this.$props.modelValue)},onchange(){this.$emit("update:modelValue",this.localValue,this.getEffectData)},search(e){const t=H(this.$props.selectApi)?this.$props.selectApi(e,this.formData):this.$props.selectApi,a=F(t,{...this.formData,$:this.rootData()});this.loading=!0,I(e)&&(e=e.join(",")),$.debounce(()=>{this.$http.request({method:"GET",url:a,params:{kw:e}}).then(({data:o})=>{if(!o)return;this.loading=!1;const l=o.list||o;I(l)&&(this.localOptions=l,o.length>2e3&&this.$message.warning("搜索结果的条目过多, 可能会造成页面卡顿, 请优化"))})},200)()},getLabel(e){return this.tpl===""?e[this.labelKey]:F(this.tpl,e)},viewLabel(e){let t=e;return this.localOptions?.forEach(a=>{a[this.valueKey]===e&&(t=this.getLabel(a))}),t},isArray(e){return I(e)}}}),D=(e,t)=>{const a=e.__vccOpts||e;for(const[o,l]of t)a[o]=l;return a},qa={key:0},Ka={style:{display:"inline-block",width:"100%"}},Ya={key:1};function Ga(e,t,a,o,l,s){const n=Be,i=ue,u=je,d=Ae;return e.disabled?(r(),v("span",qa,[e.isArray(e.localValue)?(r(!0),v(T,{key:0},N(e.localValue,(b,m)=>(r(),c(n,{key:m,class:"select-view"},{default:p(()=>[x(O(e.viewLabel(b)),1)]),_:2},1024))),128)):(r(),c(n,{key:1,class:"select-view"},{default:p(()=>[x(O(e.viewLabel(e.localValue)),1)]),_:1}))])):(r(),c(d,{key:1,ref:"select",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=b=>e.localValue=b),placeholder:e.placeholder,loading:e.loading,multiple:e.multiple,filterable:e.localFilterable,"multiple-limit":e.multipleLimit,"allow-create":e.allowCreate,remote:e.remote,"remote-method":b=>b&&e.search(b),style:Fe(e.fullWidth?"width:100%":""),onChange:e.onchange},{default:p(()=>[(r(!0),v(T,null,N(e.filteredOptions,b=>(r(),c(u,{key:b[e.valueKey],label:e.getLabel(b),value:b[e.valueKey]},{default:p(()=>[b.previewHtml?(r(),c(i,{key:0,"raw-content":"",effect:"light",content:b.previewHtml,placement:"right"},{default:p(()=>[S("span",Ka,O(e.getLabel(b)),1)]),_:2},1032,["content"])):(r(),v("span",Ya,O(e.getLabel(b)),1))]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading","multiple","filterable","multiple-limit","allow-create","remote","remote-method","style","onChange"]))}const Ct=D(za,[["render",Ga]]),Wa=B({__name:"VRadio",props:{modelValue:{type:[Number,String,Boolean],required:!0,default:0},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=t,l=_(a.modelValue),s=()=>{o("update:modelValue",l.value)};return(n,i)=>{const u=Sa,d=ua;return r(),c(d,{modelValue:L(l),"onUpdate:modelValue":i[0]||(i[0]=b=>pe(l)?l.value=b:null),disabled:e.disabled,onChange:s},{default:p(()=>[(r(!0),v(T,null,N(e.options,(b,m)=>(r(),c(u,{key:m+"-radio",label:b.value,disabled:!!b.disabled},{default:p(()=>[x(O(b.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue","disabled"])}}});function Le(){return de().appContext.config.globalProperties}const Ja=B({__name:"VChecbox",props:{options:{type:Array,default:()=>[]},modelValue:{type:[Array,void 0],default:()=>[]},disabled:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0},optionsApi:{type:String,default:""},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},ctrl:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=_(a.modelValue??[]),l=_(a.options??[]),s=t,n=()=>{s("update:modelValue",o.value)},i=Le().$http;a.optionsApi!==""&&i?.get(a.optionsApi).then(({data:m})=>{l.value=m||[]});const u=()=>{const m=[];l.value.forEach(y=>{m.push(y[a.valueKey])}),o.value=m,n()},d=()=>{o.value=[],n()},b=()=>{const m=[];l.value.forEach(y=>{m.push(y[a.valueKey])}),o.value=m.filter(y=>!new Set(o.value).has(y)),n()};return(m,y)=>{const k=q,h=W,C=mt,E=st,j=G;return r(),c(j,null,{default:p(()=>[e.ctrl?(r(),c(h,{key:0},{default:p(()=>[f(k,{text:"",type:"primary",onClick:u},{default:p(()=>[...y[1]||(y[1]=[x("全选",-1)])]),_:1}),f(k,{text:"",type:"primary",onClick:d},{default:p(()=>[...y[2]||(y[2]=[x("全不选",-1)])]),_:1}),f(k,{text:"",type:"primary",onClick:b},{default:p(()=>[...y[3]||(y[3]=[x("反选",-1)])]),_:1})]),_:1})):V("",!0),f(h,null,{default:p(()=>[f(E,{modelValue:L(o),"onUpdate:modelValue":y[0]||(y[0]=g=>pe(o)?o.value=g:null),max:e.max,min:e.min,disabled:e.disabled,onChange:n},{default:p(()=>[(r(!0),v(T,null,N(L(l),(g,w)=>(r(),c(C,{key:w+"-checkbox",label:g[a.valueKey]},{default:p(()=>[x(O(g[a.labelKey]),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","max","min","disabled"])]),_:1})]),_:1})}}}),Qa={name:"VRangeNumber",props:{modelValue:{type:[Array,String],default:","},disabled:{type:Boolean,default:!1},unit:{type:String,default:""},width:{type:String,default:"350px"}},emits:["update:modelValue"],data(){let e,t;return I(this.$props.modelValue)?[e,t]=this.$props.modelValue.map(a=>Number(a)):[e,t]=this.$props.modelValue.split(","),{localValue:this.arrToNum([e,t]),isFocus:!1}},methods:{active(e){this.isFocus=!!e},varToNum(e){return(e+"").replace(/[^\d.]/g,"").replace(/\.+/,".")},arrToNum(e){return e.map(t=>{if(t==="")return;const a=this.varToNum(t);return Number(a)})},onchange(){this.localValue=this.arrToNum(this.localValue),this.$emit("update:modelValue",this.localValue)}}},Xa=["disabled"],Za=["disabled"],el={key:0,class:"el-range-separator"};function tl(e,t,a,o,l,s){const n=vt("out-click");return Q((r(),v("div",{class:U("el-date-editor el-date-editor--datetimerange el-input__wrapper el-range-editor "+(l.isFocus?" is-active":"")),style:Fe({width:a.width})},[Q(S("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>l.localValue[0]=i),autocomplete:"off",class:"el-range-input",disabled:a.disabled,onChange:t[1]||(t[1]=(...i)=>s.onchange&&s.onchange(...i)),onFocus:t[2]||(t[2]=i=>s.active(!0))},null,40,Xa),[[Ze,l.localValue[0],void 0,{number:!0}]]),t[6]||(t[6]=x()),t[7]||(t[7]=S("span",{class:"el-range-separator"},"~",-1)),t[8]||(t[8]=x()),Q(S("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>l.localValue[1]=i),autocomplete:"off",class:"el-range-input",disabled:a.disabled,onChange:t[4]||(t[4]=(...i)=>s.onchange&&s.onchange(...i)),onFocus:t[5]||(t[5]=i=>s.active(!0))},null,40,Za),[[Ze,l.localValue[1],void 0,{number:!0}]]),t[9]||(t[9]=x()),a.unit?(r(),v("span",el,O(a.unit),1)):V("",!0)],6)),[[n,()=>s.active(!1)]])}const al=D(Qa,[["render",tl],["__scopeId","data-v-da091ba3"]]),ll={__name:"MonacoEditor",props:{mod:{type:String,default:"html"},modelValue:{type:String,default:""},options:{type:Object,default:()=>({})},clearable:{type:Boolean,default:!1},vsPath:{type:String,default:"https://cdn.jsdelivr.net/npm/monaco-editor@0.30.1/min/vs"}},emits:["update:modelValue","blur"],setup(e,{expose:t,emit:a}){const o=Na("vsPath",""),l=h=>{if(document.getElementById(h))return;const C=document.createElement("script");C.type="text/javascript",C.src=h,C.id=h,document.body.append(C)},s=()=>{if(window.monaco)return new Promise(C=>C(window.monaco));const h=o||n.vsPath;return l(h+"/loader.js"),new Promise((C,E)=>{const j=setInterval(()=>{window.require&&(require.config({paths:{vs:h}}),require(["vs/editor/editor.main"],()=>{C(window.monaco),clearInterval(j)},()=>{E("error")}))},50)})},n=e,i=a,u=_();let d,b,m=null;Ie(async()=>{b=await s();const{editor:h}=b;m=h.createModel(n.modelValue,n.mod),u.value&&(b.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemaValidation:"error"}),d=h.create(u.value,$.merge({model:m,tabSize:4,automaticLayout:!0,foldingStrategy:"indentation",scrollBeyondLastLine:!1,glyphMargin:!1,folding:!0,scrollbar:{alwaysConsumeMouseWheel:!1},minimap:{enabled:!1}},n.options)),d.onDidChangeModelContent(()=>{const C=d.getValue();i("update:modelValue",C)}),d.onDidContentSizeChange(()=>{const C=Math.min(1500,d.getContentHeight());u.value.style.height=`${C}px`,d.layout()}),d.onDidBlurEditorWidget(()=>{k(),i("blur",{editor:d,markers:b.editor.getModelMarkers({})})}))});let y=[];const k=()=>{const h=b.editor.getModelMarkers({});return h.length>0?(d.revealLineInCenter(h[0].endLineNumber),y=d.deltaDecorations(y,[{range:new b.Range(h[0].endLineNumber,1,h[0].endLineNumber,1),options:{isWholeLine:!0,className:"myContentClass",glyphMarginClassName:"myGlyphMarginClass"}}]),xe("myGlyphMarginClass"),!1):(d.deltaDecorations(y,[]),!0)};return t({validate:k}),gt(()=>{d&&d.dispose()}),(h,C)=>(r(),v("div",{ref_key:"dom",ref:u,class:"editor"},null,512))}},Me=D(ll,[["__scopeId","data-v-a25f8e4f"]]),$t=B({__name:"VJson",props:{modelValue:{type:[String,Object,Array],default:void 0},disabled:{type:Boolean,default:!1},validateEvent:{type:Boolean,default:!0}},emits:["update:modelValue","blur"],setup(e,{expose:t,emit:a}){const o=e,l=a,s=o.modelValue||"",n=K(s),i=_(n?s:JSON.stringify(s,null,2)),u=()=>{l("update:modelValue",n?i.value:JSON.parse(i.value))},d=_();return t({validate:()=>d.value.validate()}),(b,m)=>(r(),c(Me,{ref_key:"editor",ref:d,modelValue:L(i),"onUpdate:modelValue":[m[0]||(m[0]=y=>pe(i)?i.value=y:null),u],mod:"json"},null,8,["modelValue"]))}}),ol={name:"VIconSelect",props:{options:{type:Array,default:()=>[]},modelValue:{type:String,default:""},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{filter:"",showIcons:!1,localValue:this.$props.modelValue,elIconList:[],key:0}},beforeCreate(){fetch("http://assest.daodao.run/element-plus-icons.json").then(e=>e.json()).then(e=>{this.elIconList=e}).catch(function(){})},methods:{onselected(e){this.localValue=e,this.key++,this.$emit("update:modelValue",this.localValue),this.$refs.popover.hide()},focus(){}}};function sl(e,t,a,o,l,s){const n=A("v-icon"),i=Oe,u=W,d=G,b=_a,m=ha;return r(),c(m,{ref:"popover",placement:"bottom-start",trigger:"click",width:650},{reference:p(()=>[f(i,{modelValue:l.localValue,"onUpdate:modelValue":t[0]||(t[0]=y=>l.localValue=y),disabled:a.disabled,style:{width:"60%"},onFocus:s.focus},{prepend:p(()=>[(r(),c(n,{key:l.key,name:l.localValue||""},null,8,["name"]))]),_:1},8,["modelValue","disabled","onFocus"])]),default:p(()=>[f(b,{style:{"max-height":"300px",overflow:"auto"}},{default:p(()=>[f(i,{modelValue:l.filter,"onUpdate:modelValue":t[1]||(t[1]=y=>l.filter=y),placeholder:"搜索...",onFocus:s.focus},null,8,["modelValue","onFocus"]),f(d,{class:"icon-list"},{default:p(()=>[(r(!0),v(T,null,N(l.elIconList.filter(y=>y.indexOf(l.filter)!==-1),(y,k)=>(r(),c(u,{key:k,span:2,onClick:h=>s.onselected(y)},{default:p(()=>[f(n,{class:U({"icon-cell":!0,active:y===l.localValue}),name:y},null,8,["class","name"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},512)}const nl=D(ol,[["render",sl],["__scopeId","data-v-ffed56d6"]]),rl=B({name:"VSubForm",components:{Plus:Pe,Minus:bt,VForm:te(()=>Promise.resolve().then(()=>It))},inject:["formData","dev","mod"],props:{repeat:{type:Boolean,default:!1},max:{type:Number,default:100},formItems:{type:Array,default:()=>[]},modelValue:{type:[Object,Array],default:()=>({})},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>({})}},emits:["update:modelValue"],data(){let e=[];const t=$.cloneDeep(this.$props.modelValue);return this.$props.repeat===!0&&I(this.$props.modelValue)?e=t:this.$props.repeat===!1&&X(this.$props.modelValue)?e.push(t):e.push({}),e.length===0&&e.push({}),{key:1,fApis:[],sub:e,formOptions:$.merge(this.$props.options,{submitButton:!1,cancelButton:!1,disabled:this.disabled})}},watch:{$props:{immediate:!0,handler(e){e.repeat===!0&&!I(e.modelValue)&&console.error("sub-form type is repeat: modelValue must is array"),e.repeat===!1&&!X(e.modelValue)&&console.error("sub-form type is single: modelValue must is Object")}}},methods:{push(){this.sub.push({})},remove(e){this.sub=$.remove(this.sub,(t,a)=>a!==e),this.key++,this.$emit("update:modelValue",this.repeat?this.sub:this.sub[0])},onchange(){this.$emit("update:modelValue",this.repeat?this.sub:this.sub[0])},subMounted(e,t){this.fApis[t]=e},validate:async function(){let e=!0;for(let t=0;t<this.fApis.length;t++){const a=this.fApis[t];if(!e)return!1;await a.validate()||(e=!1)}return e},getRootData(){return this.formData}}}),il={class:"sub-form"},ul={class:"box"},dl={class:"box"};function pl(e,t,a,o,l,s){const n=A("v-form"),i=W,u=A("Minus"),d=Z,b=q,m=A("Plus"),y=G;return r(),v("div",il,[(r(!0),v(T,null,N(e.sub,(k,h)=>(r(),c(y,{key:h+"-"+e.key},{default:p(()=>[f(i,{class:"sub-form-item",span:e.repeat?22:24},{default:p(()=>[f(n,{ref_for:!0,ref:"subForm"+h,modelValue:e.sub[h],"onUpdate:modelValue":[C=>e.sub[h]=C,e.onchange],"is-sub":!0,options:e.formOptions,"form-items":e.$props.formItems,"root-data":e.getRootData,disable:e.disabled,mod:e.mod,onMounted:C=>e.subMounted(C,h)},null,8,["modelValue","onUpdate:modelValue","options","form-items","root-data","disable","mod","onMounted"])]),_:2},1032,["span"]),e.repeat&&!e.disabled?(r(),c(i,{key:0,span:2},{default:p(()=>[S("div",ul,[e.sub.length>1?(r(),c(b,{key:0,type:"danger",circle:"",size:"small",onClick:C=>e.remove(h)},{icon:p(()=>[f(d,null,{default:p(()=>[f(u)]),_:1})]),_:1},8,["onClick"])):V("",!0)]),S("div",dl,[h===e.sub.length-1&&e.sub.length<e.max?(r(),c(b,{key:0,type:"primary",size:"small",circle:"",onClick:e.push},{icon:p(()=>[f(d,null,{default:p(()=>[f(m)]),_:1})]),_:1},8,["onClick"])):V("",!0)])]),_:2},1024)):V("",!0)]),_:2},1024))),128))])}const cl=D(rl,[["render",pl],["__scopeId","data-v-0f559968"]]),hl={components:{Plus:Pe},inject:["formData"],props:{modelValue:{type:[Array,String],default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},action:{type:String,default:"#"},headers:{type:Object,default:()=>{}},limit:{type:Number,default:1},accept:{type:String,default:""},format:{type:Array,default:e=>[]},maxSize:{type:Number,default:0},type:{type:String,default:"image"}},emits:["update:modelValue"],data(){return{delIcon:!1,dialogImageUrl:"",dialogVisible:!1,fileList:Jt(this.$props.modelValue).map(this.parseFile),tip:"",tempIndex:1,reqHeaders:Object.assign(Tt(),this.$props.headers)}},mounted(){setTimeout(()=>{this.uploadAction()},20),this.addDownloadIcon()},methods:{addDownloadIcon(){this.$refs.upload.$el.getElementsByClassName("el-upload-list__item-actions").forEach((e,t)=>{if(this.delIcon||e.getElementsByClassName("el-icon-download").length)return;const a=document.createElement("span");a.innerHTML='<span class="el-upload-list__item-delete"><i class="iconfont ra-download"></i></span>',a.onclick=()=>{const o=this.fileList[t];Wt(o.url,o.name)},this.delIcon=!0,e.appendChild(a)})},parseFile(e="",t){let a="";return this.fileList&&this.fileList[t]&&this.fileList[t].url===e&&(a=this.fileList[t].uid||Date.now()+this.tempIndex++),{url:e,name:e.split("/").pop(),status:"success",uid:a||Date.now()+this.tempIndex++}},uploadAction(){const e=this.uploadEl();this.fileList&&this.fileList.length>=this.limit?e&&(e.style.display="none"):e&&(e.style.display="inline-block");const t=this.fileList.map(o=>o.url);this.addDownloadIcon();const a=this.limit===1?t[0]??"":t;this.$emit("update:modelValue",a)},handleRemove(e,t){this.fileList=t,this.uploadAction()},preview(e){if(e.status!=="success")return!1;this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUpload(e){const{format:t,maxSize:a}={format:this.format,maxSize:this.maxSize},{name:o,size:l}=e;return t&&t.length>0&&t.indexOf(o.split(".").reverse()[0])===-1?(this.$message.warning(`格式错误，仅支持后缀名为 ${t.join("、")} 的文件!`),!1):a&&a<l/1024?(this.$message.warning(`文件大小不能超过 ${a}KB !`),!1):!0},onExceed(){this.$message.warning(`最多只能上传${this.limit}个`)},uploadEl(){if(this.$refs.upload)return this.$refs.upload.$el.getElementsByClassName("el-upload")[0]},onError(e,t,a){this.$notify.error({title:"上传失败",message:e})},onSuccess(e,t,a){if(e.code!==0){this.$notify.error({title:e.message||"上传失败.",message:t.name}),this.fileList=$.remove(a,l=>l.response.code===0);return}const o=e.data?.url;if(!o){this.$notify.error({message:"上传接口错误"});return}t.url=o,a[0].url=o,this.fileList=a,this.uploadAction()},httpRequest(e){return new Promise((t,a)=>{const o=new FormData;o.append("file",e.file),this.$http.create().request({url:F(e.action,this.formData),method:e.method,data:o,headers:{"Content-Type":"multipart/form-data",...e.headers}}).then(l=>{t(l.data)}).catch(l=>{a(l)})})}}},ml=["innerHTML"];function fl(e,t,a,o,l,s){const n=A("plus"),i=Z,u=q,d=ca,b=nt,m=ie;return r(),v(T,null,[f(d,{ref:"upload",class:"uploader ok",action:a.action,"list-type":a.type==="image"?"picture-card":"text",limit:a.limit,multiple:a.limit>1,"file-list":l.fileList,disabled:a.disabled,"before-upload":s.beforeUpload,"on-preview":s.preview,"on-remove":s.handleRemove,"on-exceed":s.onExceed,"on-success":s.onSuccess,"on-error":s.onError,headers:l.reqHeaders,"http-request":s.httpRequest},ge({tip:p(()=>[S("div",{innerHTML:l.tip},null,8,ml)]),_:2},[l.fileList.length<a.limit?{name:"default",fn:p(()=>[a.type==="image"?(r(),c(i,{key:0,class:"uploader-icon"},{default:p(()=>[f(n)]),_:1})):V("",!0),a.type==="file"?(r(),c(u,{key:1,size:"small",type:"primary"},{default:p(()=>[...t[1]||(t[1]=[x("点击上传",-1)])]),_:1})):V("",!0)]),key:"0"}:void 0]),1032,["action","list-type","limit","multiple","file-list","disabled","before-upload","on-preview","on-remove","on-exceed","on-success","on-error","headers","http-request"]),f(m,{modelValue:l.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=y=>l.dialogVisible=y)},{default:p(()=>[f(b,{src:l.dialogImageUrl,lazy:""},null,8,["src"])]),_:1},8,["modelValue"])],64)}const St=D(hl,[["render",fl]]),bl={mounted(e,t){t.value&&Ta(t.value).mask(e.getElementsByTagName("input")[0])}},yl=B({directives:{mask:bl},props:{modelValue:{type:[String,Number,Object,Array],default:""},showWordLimit:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autosize:{type:[Boolean,Object],default:()=>({minRows:2})},rows:{type:Number,default:6},showCopy:{type:Boolean,default:!1},showPassword:{type:Boolean,default:!1},mask:{type:[String,Object],default:""},placeholder:{type:String,default:""},type:{type:String,default:""}},emits:["change","blur","clear","input","inputNative","copy","focus","update:modelValue"],data(){return{inputValue:""}},watch:{modelValue:{handler:function(e){this.inputValue=e||""},immediate:!0}},created(){},methods:{updateModel(e){this.$emit("update:modelValue",e)},change(e){this.$emit("change",e)},blur(e){this.$emit("blur",e)},focus(e){this.$emit("focus",e)},clear(){this.$emit("clear")},input(){this.$emit("input",this.inputValue)},copy(){at(this.inputValue),this.$emit("copy")}}});function gl(e,t,a,o,l,s){const n=q,i=Oe,u=vt("mask");return Q((r(),c(i,M({modelValue:e.inputValue,"onUpdate:modelValue":t[0]||(t[0]=d=>e.inputValue=d),"show-word-limit":e.showWordLimit,rows:e.rows,clearable:e.clearable,disabled:e.disabled,"show-password":e.showPassword,type:e.type},e.$attrs,{autosize:e.autosize,placeholder:e.placeholder,onChange:e.change,onFocus:e.focus,onClear:e.clear,onBlur:e.blur,onInput:e.input,"onUpdate:modelValue":e.updateModel}),ge({_:2},[e.showCopy?{name:"append",fn:p(()=>[e.showCopy?(r(),c(n,{key:0,icon:"el-icon-copy-document",onClick:e.copy},null,8,["onClick"])):V("",!0)]),key:"0"}:void 0]),1040,["modelValue","show-word-limit","rows","clearable","disabled","show-password","type","autosize","placeholder","onChange","onFocus","onClear","onBlur","onInput","onUpdate:modelValue"])),[[u,e.mask]])}const _t=D(yl,[["render",gl],["__scopeId","data-v-740439c4"]]),vl=B({name:"VCascader",props:{options:{type:Array,default:()=>[]},modelValue:{type:[Array,Number],default:void 0},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},props:{type:Object,default:e=>{}},size:{type:String,default:""},optionsApi:{type:String,default:""},saveAs:{type:String,default:"array"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=_($.cloneDeep(we(e.modelValue)?[e.modelValue]:e.modelValue)),o=_(e.options),l=_(0),s=de()?.appContext.config.globalProperties.$http;return ye(()=>{e.optionsApi&&s.request({method:"GET",url:e.optionsApi}).then(({data:n})=>{o.value=n||[],we(e.modelValue)&&(a.value=Gt(o.value,e.modelValue,e.props.value||"value")),l.value++})}),{localValue:a,optionTree:o,onchange:()=>{let n=a;we(e.modelValue)&&(n=a.value[a.value.length-1]),e.saveAs==="array"?n=a.value:e.saveAs==="number"&&(n=a.value[a.value.length-1]),t("update:modelValue",n)},key:l}}});function wl(e,t,a,o,l,s){const n=pa;return r(),c(n,{key:e.key,modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.localValue=i),options:e.optionTree,disabled:e.disabled,clearable:e.clearable,"show-all-levels":e.showAllLevels,"collapse-tags":e.collapseTags,filterable:e.filterable,props:e.props,size:e.size,onChange:e.onchange},null,8,["modelValue","options","disabled","clearable","show-all-levels","collapse-tags","filterable","props","size","onChange"])}const kl=D(vl,[["render",wl]]),xt=e=>{let t=[];return e.forEach(a=>{t.push(a.value),a.children!==void 0&&(t=t.concat(xt(a.children)))}),t},Ot=(e,t)=>{let a=[];for(let o=0;o<t.length;o++){const l=t[o];if(l.value===e){l.children!==void 0?a=a.concat(xt(l.children)):a.push(l.value);continue}l.children!==void 0&&(a=a.concat(Ot(e,l.children)))}return a},Vl=(e,t)=>{let a=[];return e.forEach(o=>{a=a.concat(Ot(o,t))}),a},Cl=B({props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},props:{type:Object,default:e=>{}},size:{type:String,default:""},optionsApi:{type:String,default:""}},emits:["update:modelValue"],setup(e,t){const{$http:a}=Le(),o=_([]),l=_([]);ye(async()=>{if(e.optionsApi){const{data:i}=await a.get(e.optionsApi);o.value=i||[]}else o.value=e.options;e.props.emitPath?l.value=e.modelValue:l.value=Vl(e.modelValue,o.value)});const s=i=>{if(e.props.emitPath)t.emit("update:modelValue",i);else{const u=[];n.value.getCheckedNodes().forEach(d=>{d.parent&&d.parent.checked||u.push(d.value)}),t.emit("update:modelValue",u)}},n=_(null);return{localVal:l,onchange:s,cas:n,optionsTree:o}}});function $l(e,t,a,o,l,s){const n=da;return r(),c(n,{ref:"cas",modelValue:e.localVal,"onUpdate:modelValue":t[0]||(t[0]=i=>e.localVal=i),options:e.optionsTree,disabled:e.disabled,clearable:e.clearable,"show-all-levels":e.showAllLevels,"collapse-tags":e.collapseTags,filterable:e.filterable,props:e.props,size:e.size,onChange:e.onchange},null,8,["modelValue","options","disabled","clearable","show-all-levels","collapse-tags","filterable","props","size","onChange"])}const Bt=D(Cl,[["render",$l]]),Sl=B({name:"VFilter",components:{FormItem:te(()=>Promise.resolve().then(()=>Pt)),draggable:Ea},inject:["formData","dev"],props:{formItems:{type:Array,default:()=>[]},modelValue:{type:Array||null,default:()=>[]},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},showLabel:{type:Boolean,default:!0}},emits:["update:modelValue"],data(){const e=this.$props.modelValue?this.$props.modelValue:[];e.length===0&&e.push({field:"",value:void 0});const t=[];return this.$props.formItems.forEach(a=>{t.push({value:a.field,label:a.label})}),{key:1,fApis:[],sub:e,localOptions:t,formOptions:$.merge(this.$props.options,{submitButton:!1,cancelButton:!1}),plus:Xe(Pe),minus:Xe(bt)}},computed:{itemKey(){return Object.keys(this.$props.formItems[0]|{})[0]}},methods:{push(){this.sub.push({field:void 0,value:void 0})},remove(e){this.sub=$.remove(this.sub,(t,a)=>a!==e),this.key++,this.$emit("update:modelValue",this.sub)},onchange(){const e=[];this.sub.forEach(t=>{t.value!==void 0&&e.push({field:t.field,value:t.value})}),this.$emit("update:modelValue",e)},subMounted(e,t){this.fApis[t]=e},validate(){let e=!0;return this.fApis.forEach(t=>{if(!e)return!1;t.validate(a=>{a||(e=!1)})}),e},getRootData(){return this.formData},getFormitem(e){const t=this.sub[e].field;let a={};return this.$props.formItems.forEach(o=>{o.field===t&&(a=o)}),a},fieldChange(e){this.sub[e].id===void 0?this.sub[e].id=1:this.sub[e].id+=1},onFiledChange(){},allowOptions(e){const t=[];return this.sub.forEach((a,o)=>{o<e&&t.push(a.field)}),$.filter(this.localOptions,a=>t.indexOf(a.value)<0)}}}),_l={class:"sub-form"},xl={key:0};function Ol(e,t,a,o,l,s){const n=je,i=Ae,u=W,d=A("form-item"),b=G,m=q,y=A("draggable");return r(),v("div",_l,[f(y,{modelValue:e.sub,"onUpdate:modelValue":t[0]||(t[0]=k=>e.sub=k),group:"filter","item-key":e.itemKey,disabled:e.disabled,onStart:t[1]||(t[1]=k=>e.drag=!0),onEnd:t[2]||(t[2]=k=>e.drag=!1)},{item:p(({element:k,index:h})=>[f(b,null,{default:p(()=>[f(u,{class:"sub-form-item",span:22},{default:p(()=>[f(b,null,{default:p(()=>[e.showLabel?(r(),c(u,{key:0,span:4},{default:p(()=>[f(i,{modelValue:e.sub[h].field,"onUpdate:modelValue":C=>e.sub[h].field=C,disabled:e.$props.disabled||h<e.sub.length-1,onChange:()=>e.fieldChange(h)},{default:p(()=>[(r(!0),v(T,null,N(e.allowOptions(h),C=>(r(),c(n,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1024)):V("",!0),f(u,{span:16},{default:p(()=>[e.sub[h].field?(r(),c(d,{key:0,modelValue:e.sub[h].value,"onUpdate:modelValue":[C=>e.sub[h].value=C,e.onchange],item:e.getFormitem(h),"form-options":{disabled:e.$props.disabled}},null,8,["modelValue","onUpdate:modelValue","item","form-options"])):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),e.disabled?V("",!0):(r(),c(u,{key:0,span:2,class:"sub-form-item-action"},{default:p(()=>[S("div",null,[S("div",null,[e.sub.length>1?(r(),c(m,{key:0,class:"action",type:"danger",icon:e.minus,circle:"",onClick:C=>e.remove(h)},null,8,["icon","onClick"])):V("",!0)]),h===e.sub.length-1&&h<e.formItems.length-1?(r(),v("div",xl,[e.allowOptions(h).length>1?(r(),c(m,{key:0,class:"action",type:"primary",icon:e.plus,circle:"",onClick:e.push},null,8,["icon","onClick"])):V("",!0)])):V("",!0)])]),_:2},1024))]),_:2},1024)]),_:1},8,["modelValue","item-key","disabled"])])}const Bl=D(Sl,[["render",Ol],["__scopeId","data-v-ce9ff07b"]]),Al=B({name:"VShow",inject:["formData"],props:{tpl:{type:[String,Array,Object],default:""},dataApi:{type:String,default:""},watch:{type:String,default:""},auto:{type:Boolean,default:!0},text:{type:String,default:"查询"},interval:{type:Number,default:0},timeout:{type:Number,default:0},modelValue:{type:String,default:""}},emits:["update:modelValue"],data(){if(this.auto){const e=$.debounce(t=>{this.request(t)},300);this.$watch(this.$props.watch?`formData.${this.$props.watch}`:"formData",e,{deep:!0,immediate:!0})}return{showTpl:"",key:0,loading:!1,instance:void 0,usTime:0}},beforeUnmount(){this.instance&&clearInterval(this.instance)},methods:{getTpl(e){if(I(this.tpl)){for(let t=0;t<this.tpl.length;t++)if(oe(this.formData,this.tpl[t].when))return this.makeTpl(this.tpl[t].tpl,e||this.formData);return""}return this.makeTpl(this.tpl,e||this.formData)},makeTpl(e,t){return(a=>a.indexOf("function(")===0)(e)?new Function("return "+e)()(t||this.formData):e},requestApi(e,t){t&&(this.loading=!0);try{this.$http({method:"GET",url:F(this.$props.dataApi,{...this.formData})}).then(({data:a})=>{const o=Object.assign({},e,a);a.formData!=null&&(Object.keys(a.formData).forEach(l=>{this.formData[l]=a.formData[l],this.$emit("update:modelValue",l,a.formData[l])}),this.showTpl=F(this.getTpl(o),o),this.$emit("update:modelValue",this.showTpl),console.warn("showTpl5",this.showTpl)),this.$props.interval&&a.state==="done"&&(clearInterval(this.instance),this.instance=void 0,this.usTime=0,this.loading=!1),t&&(this.loading=!1)}).catch(a=>{t&&(this.loading=!1),this.$props.interval&&(clearInterval(this.instance),this.instance=void 0,this.usTime=0,this.loading=!1)})}catch{t&&(this.loading=!1)}},request(e){this.$props.dataApi?this.$props.interval?(this.loading=!0,this.instance=setInterval(async()=>{if(this.$props.timeout>0&&this.usTime>=this.$props.timeout){clearInterval(this.instance),this.instance=void 0,this.$message.error("查询超时, 请重试");return}await this.requestApi(e),this.usTime+=this.$props.interval},this.$props.interval)):this.requestApi(e,!0):this.showTpl=F(this.getTpl(),e),this.key++}}}),Dl=["innerHTML"];function jl(e,t,a,o,l,s){const n=q;return r(),v("div",null,[e.loading?V("",!0):(r(),v("span",{key:e.key,innerHTML:e.modelValue||e.showTpl},null,8,Dl)),e.auto?V("",!0):(r(),c(n,{key:1,loading:e.loading,onClick:t[0]||(t[0]=()=>e.request({}))},{default:p(()=>[x(O(e.text),1)]),_:1},8,["loading"]))])}const Tl=D(Al,[["render",jl]]),El=B({__name:"VDate",props:{disabledDate:{type:[Function,Array],default:()=>e=>!1}},setup(e){const t=e,a=o=>{if(H(t.disabledDate))return t.disabledDate(o);const l=t.disabledDate;if(I(l[0])){for(let s=0;s<l.length;s++)if(Je(o,Qe(l[s][1]),l[s][0]))return!0}else{const s=l;if(Je(o,Qe(s[1]),s[0]))return!0}return!1};return(o,l)=>{const s=xa;return r(),c(s,{"disabled-date":a})}}}),Pl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"};function Il(e,t){return r(),v("svg",Pl,[...t[0]||(t[0]=[S("g",{fill:"none","fill-rule":"evenodd"},[S("path",{d:"M0 0h400v400H0z"}),S("path",{fill:"currentColor",d:"M310 132v30h-96v75.5h96.5v30h-107v-.5H184V162H89v-30z"}),S("circle",{cx:"200",cy:"200",r:"199",stroke:"#000","stroke-opacity":".546","stroke-width":"2"})],-1)])])}const Fl={render:Il},Ll={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"};function Ml(e,t){return r(),v("svg",Ll,[...t[0]||(t[0]=[S("g",{fill:"none","fill-rule":"evenodd"},[S("path",{d:"M0 0h400v400H0z"}),S("circle",{cx:"200",cy:"200",r:"197.5",stroke:"#000","stroke-opacity":".546","stroke-width":"5"}),S("path",{fill:"currentColor",d:"M215 74v105h105v30H215v105h-30l-.001-105H80v-30h105V74z"})],-1)])])}const Nl={render:Ml},Rl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"};function Hl(e,t){return r(),v("svg",Rl,[...t[0]||(t[0]=[S("g",{fill:"none","fill-rule":"evenodd",transform:"rotate(90 200 200)"},[S("path",{d:"M0 0h400v400H0z"}),S("circle",{cx:"200",cy:"200",r:"197.5",stroke:"#000","stroke-opacity":".546","stroke-width":"5"}),S("path",{fill:"currentColor",d:"M185 314V74h30v240z"})],-1)])])}const Ul={render:Hl},zl=B({components:{SvgGroup:Fl,SvgAdd:Nl,SvgRemove:Ul,FormItem:te(()=>Promise.resolve().then(()=>Pt))},props:{rule:{type:Object,default:e=>{}},formItems:{type:Array,default:e=>[]},factorOptions:{type:Array,default:e=>[]},addChildVisible:{type:Boolean,default:!0},maxDepth:{type:Number,default:3},deep:{type:Number,default:1},disabled:{type:Boolean,default:!1},ctrl:{type:Object,default:()=>{}}},emits:["add","addChild","delete","change"],data(){return{rules:{field:[{required:!0,message:"请选择",trigger:"change"}],operator:[{required:!0,message:"请选择",trigger:"change"}],value:[{required:!0,message:"请输入",trigger:["blur","change"]}]},defaultOperatorOptions:[{value:"=",label:"等于"},{value:">",label:"大于"},{value:"<",label:"小于"},{value:">=",label:"大于等于"},{value:"<=",label:"小于等于"},{value:"!=",label:"不等于"},{value:"in",label:"在其中"},{value:"not in",label:"不在其中"},{value:"has",label:"包含"},{value:"not has",label:"不包含"}],operatorOptions:[],valueKey:0}},watch:{rule:{handler(e){this.operatorOptions=[],this.formItems.forEach(t=>{t.field===e.field&&t.operatorOptions!==void 0&&(this.operatorOptions=t.operatorOptions)}),this.operatorOptions.length===0&&(this.operatorOptions=this.defaultOperatorOptions)},immediate:!0,deep:!0}},methods:{async validate(){return this.$refs._form.validate()},addRow(){this.$emit("add")},addChild(){this.$emit("addChild")},deleteRow(){this.$emit("delete")},change(e){this.$emit("change",e)},getFormItem(){const e=this.rule.field;let t={};return this.$props.formItems.forEach(a=>{a.field===e&&(t={...a})}),t.props=t.props||{},t.props.disabled=this.disabled,t}}}),ql={class:"ruleFields"};function Kl(e,t,a,o,l,s){const n=je,i=Ae,u=De,d=W,b=A("FormItem"),m=A("SvgGroup"),y=ue,k=Z,h=A("SvgRemove"),C=A("SvgAdd"),E=G,j=Te;return r(),v("div",ql,[(r(),c(j,{ref:"_form",key:e.rule.field,model:e.rule,rules:e.rules,inline:"",size:"small"},{default:p(()=>[f(E,null,{default:p(()=>[f(d,{span:6},{default:p(()=>[f(u,{prop:"field"},{default:p(()=>[f(i,{modelValue:e.rule.field,"onUpdate:modelValue":t[0]||(t[0]=g=>e.rule.field=g),placeholder:"请选择",filterable:"",disabled:e.disabled,onChange:t[1]||(t[1]=()=>e.change("field"))},{default:p(()=>[(r(!0),v(T,null,N(e.factorOptions,(g,w)=>(r(),c(n,{key:w,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),f(d,{span:6},{default:p(()=>[f(u,{prop:"operator"},{default:p(()=>[f(i,{modelValue:e.rule.operator,"onUpdate:modelValue":t[2]||(t[2]=g=>e.rule.operator=g),placeholder:"符号",disabled:e.disabled,onChange:t[3]||(t[3]=()=>e.change("operator"))},{default:p(()=>[(r(!0),v(T,null,N(e.operatorOptions,(g,w)=>(r(),c(n,{key:w,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),f(d,{span:6},{default:p(()=>[f(u,{prop:"value"},{default:p(()=>[(r(),c(b,{key:e.valueKey,modelValue:e.rule.value,"onUpdate:modelValue":[t[4]||(t[4]=g=>e.rule.value=g),t[5]||(t[5]=()=>e.change("value"))],"show-label":!1,item:e.getFormItem(),disabled:e.disabled},null,8,["modelValue","item","disabled"]))]),_:1})]),_:1}),e.disabled?V("",!0):(r(),c(d,{key:0,span:6,style:{"text-align":"right"}},{default:p(()=>[e.deep<=e.maxDepth&&e.ctrl.addSub?(r(),c(k,{key:0,size:"mini",color:"#67C23A"},{default:p(()=>[f(y,{placement:"top-start",content:"添加规则组"},{default:p(()=>[f(m,{style:{color:"green",padding:"2px"},onClick:e.addChild},null,8,["onClick"])]),_:1})]),_:1})):V("",!0),e.ctrl.del?(r(),c(k,{key:1,size:"mini",color:"#F56C6C"},{default:p(()=>[f(y,{placement:"top-start",content:"删除"},{default:p(()=>[f(h,{style:{color:"red",padding:"2px"},onClick:e.deleteRow},null,8,["onClick"])]),_:1})]),_:1})):V("",!0),e.ctrl.addBrother?(r(),c(k,{key:2,size:"mini",color:"#909399"},{default:p(()=>[f(y,{placement:"top-start",content:"添加同层规则"},{default:p(()=>[f(C,{style:{color:"gray",padding:"2px"},onClick:e.addRow},null,8,["onClick"])]),_:1})]),_:1})):V("",!0)]),_:1}))]),_:1})]),_:1},8,["model","rules"]))])}const Yl=D(zl,[["render",Kl],["__scopeId","data-v-700634d0"]]),Gl={props:{root:{type:Boolean,default:!1},left:{type:Boolean,default:!1},modelValue:{type:String,default:"and"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{localValue:""}},watch:{modelValue:{handler(e){this.localValue=e},immediate:!0,deep:!0}},methods:{onclick(){this.localValue=this.localValue==="and"?"or":"and",this.$emit("update:modelValue",this.localValue)}}},Wl={key:0,class:"logic"},Jl={key:1};function Ql(e,t,a,o,l,s){return r(),v("div",{class:U("ident "+(a.left?"line-left":""))},[a.root?V("",!0):(r(),v("div",Wl,[a.disabled?(r(),v("span",Jl,O(l.localValue==="and"?"且":"或"),1)):(r(),v("i",{key:0,class:U("iconfont "+(l.localValue==="and"?"ra-and":"ra-or")),onClick:t[0]||(t[0]=(...n)=>s.onclick&&s.onclick(...n))},null,2))])),t[1]||(t[1]=S("div",{class:"line"},null,-1))],2)}const Xl=D(Gl,[["render",Ql],["__scopeId","data-v-2bd34a41"]]),Zl={name:"RuleCreate",components:{CirclePlus:Ba,RuleFields:Yl,RuleIdent:Xl},inject:["formData"],props:{modelValue:{type:Array,default:e=>[]},level:{type:Number,default:e=>1},formItems:{type:Array,default:e=>[]},factoryItems:{type:Array,default:e=>[]},optionsApi:{type:String,default:""},deep:{type:Number,default:1},maxDepth:{type:Number,default:3},disabled:{type:Boolean,default:!1},initValue:{type:Boolean,default:!0},ctrl:{type:Object,default:()=>{}}},emits:["update:modelValue","ruleTextChange"],data(){const e={logic:"and",field:"",operator:""};if(this.$props.optionsApi!==""){const t=Yt(this.$props.optionsApi);t.length>0&&t.forEach(a=>{this.$watch(`formData.${a}`,()=>{this.realOptionsApi=F(this.$props.optionsApi,this.formData),this.ruleList=[{...this.defaultConfig}]},{deep:!0,immediate:!0})})}return{validateMessage:"",defaultConfig:e,previewText:"",ruleList:[],factorOptions:this.$props.factoryItems,factoryKey:0,realOptionsApi:F(this.$props.optionsApi,this.formData),realFormItems:this.$props.formItems}},watch:{modelValue:{handler(e){Array.isArray(e)&&e.length>0?this.ruleList=e:this.initValue&&(this.ruleList=[{...this.defaultConfig}])},immediate:!0,deep:!0},previewText(){this.$emit("ruleTextChange",this.previewText)},realOptionsApi:{handler(e){this.$props.deep===1&&e&&this.$http.get(e).then(({data:t})=>{const a=t||[];this.realFormItems=a,this.makeFactory(a),this.change()})},immediate:!0,deep:!0},formItems:{handler(e){},immediate:!0,deep:!0},realFormItems:{handler(e){},immediate:!0,deep:!0}},mounted(){this.change()},methods:{addOne(){this.ruleList.push({...this.defaultConfig})},makeFactory(e){const t=[];e.forEach(a=>{t.push({value:a.field||"",label:a.label})}),this.factorOptions=t,this.factoryKey++},getKey(){return Math.random().toString(16).slice(2)},addRow(e,t){t.push({...this.defaultConfig}),this.change()},deleteRow(e,t){if(t.length===1&&this.level===1)return this.$message.warning("最少要保留一条！");t.splice(e,1),this.change()},addChild(e,t,a){a.push({...this.defaultConfig,children:[{...this.defaultConfig}]}),this.change()},validate:async function(){if(this.$refs._ruleForm){for(let e=0;e<this.$refs._ruleForm?.length;e++)if(!await this.$refs._ruleForm[e].validate())return!1}if(this.$refs._ruleCreate){for(let e=0;e<this.$refs._ruleCreate?.length;e++)if(!await this.$refs._ruleCreate[e].validate())return!1}return!0},getPreviewText(){const e=(t,a=1)=>{const o=[];return t.forEach((l,s)=>{if(l.children&&l.children.length>0){o.push([l.logic,"(",e(l.children,a+1),")"].join(" "));return}const n=this.realFormItems.filter(i=>i.field===l.field)[0];o.push([s===0?"":l.logic,n?n.label:"",l.operator,l.value].filter(i=>i!=="").join(" "))}),o.join(" ")};this.previewText=e(this.ruleList,1)},change(e,t){this.level===1&&this.getPreviewText(),e==="field"&&t!==void 0&&(this.ruleList[t].operator="",this.ruleList[t].value=void 0),this.$emit("update:modelValue",this.ruleList)},changeRecursive(e){this.change()}}},eo={key:0},to={key:1,class:"rule-row"},ao={key:0,class:"preview"},lo={key:1,class:"el-form-item__error"};function oo(e,t,a,o,l,s){const n=A("CirclePlus"),i=Z,u=A("RuleIdent"),d=W,b=A("RuleCreate"),m=A("RuleFields"),y=G;return l.ruleList.length===0?(r(),v("div",eo,[a.disabled?V("",!0):(r(),c(i,{key:0,onClick:s.addOne},{default:p(()=>[f(n)]),_:1},8,["onClick"]))])):(r(),v("div",{key:1,class:U({_ruleCreate_root:a.level===1})},[(r(!0),v(T,null,N(l.ruleList,(k,h)=>(r(),c(y,{key:`root${h}`,class:"rule-cell"},{default:p(()=>[f(d,{span:2},{default:p(()=>[f(u,{modelValue:k.logic,"onUpdate:modelValue":[C=>k.logic=C,s.change],root:h===0,left:l.ruleList.length>1,disabled:a.disabled},null,8,["modelValue","onUpdate:modelValue","root","left","disabled"])]),_:2},1024),f(d,{span:22},{default:p(()=>[k.children&&k.children.length>0?(r(),c(b,{key:`child${l.factoryKey}`,ref_for:!0,ref:"_ruleCreate",modelValue:k.children,"onUpdate:modelValue":[C=>k.children=C,s.changeRecursive],class:U(["_child_root",{"last-row-child":h===l.ruleList.length-1}]),disabled:a.disabled,level:a.level+1,"factory-items":l.factorOptions,"form-items":l.realFormItems,deep:a.deep+1},null,8,["modelValue","onUpdate:modelValue","disabled","class","level","factory-items","form-items","deep"])):(r(),v("div",to,[(r(),c(m,{ref_for:!0,ref:"_ruleForm",key:l.factoryKey,rule:k,"add-child-visible":a.level===1,"form-items":l.realFormItems,"factor-options":l.factorOptions,disabled:a.disabled,"max-depth":a.maxDepth,deep:a.deep+1,ctrl:{addSub:!0,addBrother:!0,del:!0,...a.ctrl},onAddChild:C=>s.addChild(h,k,l.ruleList),onDelete:C=>s.deleteRow(h,l.ruleList),onAdd:C=>s.addRow(h,l.ruleList),onChange:C=>s.change(C,h)},null,8,["rule","add-child-visible","form-items","factor-options","disabled","max-depth","deep","ctrl","onAddChild","onDelete","onAdd","onChange"]))]))]),_:2},1024)]),_:2},1024))),128)),a.level===1?(r(),v("div",ao,"规则预览："+O(l.previewText),1)):V("",!0),a.level===1?(r(),v("div",lo,O(l.validateMessage),1)):V("",!0)],2))}const At=D(Zl,[["render",oo],["__scopeId","data-v-33709c91"]]);function et(e){return e.length===0?0:parseInt(e.join(""),2)}function so(e){return e.toString(2).split("")}const no=B({name:"VPointCheckbox",props:{options:{type:Array,default:()=>[]},modelValue:{type:Number,default:0},disabled:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],data(){const e=so(this.$props.modelValue).reverse(),t=[];return e.forEach((a,o)=>{a==="1"&&t.push(o)}),{localValue:t}},methods:{onchange(){const e=this.$props.options.map(a=>a.value);let t=Array(Math.max(...e)).fill("0");this.localValue.forEach(a=>{t[a]="1"}),t=t.reverse(),t.join(""),et(t),this.$emit("update:modelValue",et(t))}}});function ro(e,t,a,o,l,s){const n=mt,i=st;return r(),c(i,{modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=u=>e.localValue=u),max:e.max,min:e.min,onChange:e.onchange},{default:p(()=>[(r(!0),v(T,null,N(e.options,(u,d)=>(r(),c(n,{key:d+"-checkbox",label:u.value},{default:p(()=>[x(O(u.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","max","min","onChange"])}const io=D(no,[["render",ro]]),Dt=B({__name:"VNumber",props:{modelValue:{type:Number,default:0},min:{type:[Number,String],default:-1/0}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,o=z(()=>{if(K(a.min))switch(a.min){case"current":return a.modelValue}return a.min}),l=t,s=_(a.modelValue),n=()=>{l("update:modelValue",s.value)};return(i,u)=>{const d=ia;return r(),c(d,{modelValue:L(s),"onUpdate:modelValue":[u[0]||(u[0]=b=>pe(s)?s.value=b:null),n],min:L(o)},null,8,["modelValue","min"])}}}),uo={props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],data(){return{hours:"",minutes:"",seconds:""}},watch:{modelValue:{handler(e){if(!e){this.hours=this.minutes=this.seconds=0;return}const t=parseInt(e,10);this.hours=Math.floor(t/3600),this.minutes=Math.floor((t-this.hours*3600)/60),this.seconds=t-this.hours*3600-this.minutes*60},immediate:!0}},methods:{handleInput(e,t){let a=0;t==="hours"&&(a=this.calcSeconds(e,this.minutes,this.seconds)),t==="minutes"&&(a=this.calcSeconds(this.hours,e,this.seconds)),t==="seconds"&&(a=this.calcSeconds(this.hours,this.minutes,e)),this.$emit("update:modelValue",a)},calcSeconds(e,t,a){return e*3600+t*60+a}}};function po(e,t,a,o,l,s){const n=Oe,i=W,u=G;return r(),c(u,{gutter:20},{default:p(()=>[f(i,{span:6},{default:p(()=>[f(n,{modelValue:l.hours,"onUpdate:modelValue":[t[0]||(t[0]=d=>l.hours=d),t[1]||(t[1]=d=>s.handleInput(d,"hours"))],modelModifiers:{number:!0}},{append:p(()=>[...t[6]||(t[6]=[x("时",-1)])]),_:1},8,["modelValue"])]),_:1}),f(i,{span:6},{default:p(()=>[f(n,{modelValue:l.minutes,"onUpdate:modelValue":[t[2]||(t[2]=d=>l.minutes=d),t[3]||(t[3]=d=>s.handleInput(d,"minutes"))],modelModifiers:{number:!0}},{append:p(()=>[...t[7]||(t[7]=[x("分",-1)])]),_:1},8,["modelValue"])]),_:1}),f(i,{span:6},{default:p(()=>[f(n,{modelValue:l.seconds,"onUpdate:modelValue":[t[4]||(t[4]=d=>l.seconds=d),t[5]||(t[5]=d=>s.handleInput(d,"seconds"))],modelModifiers:{number:!0}},{append:p(()=>[...t[8]||(t[8]=[x("秒",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})}const co=D(uo,[["render",po]]),ho=B({__name:"select",props:{source:{type:Array,default:()=>[]},onSelection:{type:Function,default:()=>{}}},setup(e){const t=te(()=>Promise.resolve().then(()=>qt)),a=_({}),o=_(""),l=e;l.source.length>0&&(o.value=l.source[0].label+"");const s=z(()=>{let i=-1;return l.source.forEach((u,d)=>{u.label===o.value&&(i=d)}),i}),n=i=>{l.onSelection(s.value,i)};return(i,u)=>{const d=dt,b=ct;return r(),c(b,{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=m=>o.value=m),type:"card"},{default:p(()=>[(r(!0),v(T,null,N(l.source,(m,y)=>(r(),c(d,{key:y,label:m.label,name:m.label,lazy:!0},{default:p(()=>[f(L(t),{ref_for:!0,ref:a.value[m.value],"show-pagination":!1,"show-normal-button":!1,"show-batch-button":!1,"show-row-button":!1,"show-selection":!0,"sync-url":!1,"info-api":m.infoApi,"list-api":m.listApi,onSelection:n},null,8,["info-api","list-api"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),mo={class:"dialog-footer"},fo=B({__name:"index",props:{modelValue:{type:[String,Number,Array],default:void 0},tableSchema:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:0},effectData:{type:[String,Array,Object],default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:t}){const a=t,o=e,l=_([]);be(()=>o.modelValue,m=>{m&&(l.value=o.multiple?[...m]:[m])},{immediate:!0});const s=m=>{l.value.splice(m,1)},n=_(!1),i=()=>{if(o.multiple===!1&&l.value.length>1){Ee.error("只允许选择一个");return}n.value=!1,l.value.length>0&&a("update:modelValue",o.multiple?l.value:l.value[0],We(o.effectData,{tab_id:u.value}))},u=_(),d=(m,y)=>{u.value=o.tableSchema[m].id,l.value=y.map(k=>{const h=We(o.tableSchema[m].valueKey,k);return K(o.tableSchema[m].valueKey)?h[o.tableSchema[m].valueKey]:h}).filter(k=>k)},b=()=>{n.value=!1,l.value=[],u.value=void 0};return(m,y)=>{const k=Be,h=q,C=ie;return r(),v("div",null,[(r(!0),v(T,null,N(l.value,(E,j)=>(r(),c(k,{key:E,class:"mx-1",closable:"","disable-transitions":!1,onClose:g=>s(j)},{default:p(()=>[x(O(E),1)]),_:2},1032,["onClose"]))),128)),e.multiple||l.value.length===0?(r(),c(h,{key:0,class:"button-new-tag ml-1",size:"small",onClick:y[0]||(y[0]=E=>n.value=!0)},{default:p(()=>[...y[3]||(y[3]=[x(" + 添加 ",-1)])]),_:1})):V("",!0),f(C,{ref:"dialog",modelValue:n.value,"onUpdate:modelValue":y[2]||(y[2]=E=>n.value=E),"append-to-body":!0,"destroy-on-close":!0,"before-close":b,title:"选择",width:"80%"},{footer:p(()=>[S("span",mo,[f(h,{onClick:y[1]||(y[1]=E=>n.value=!1)},{default:p(()=>[...y[4]||(y[4]=[x("取消",-1)])]),_:1}),f(h,{type:"primary",onClick:i},{default:p(()=>[...y[5]||(y[5]=[x("确定",-1)])]),_:1})])]),default:p(()=>[f(ho,{ref:"selectDom",source:e.tableSchema,"on-selection":d},null,8,["source"])]),_:1},8,["modelValue"])])}}}),bo=D(fo,[["__scopeId","data-v-eec61fd9"]]),yo={};function go(e,t){const a=Oa;return r(),c(a)}const vo=D(yo,[["render",go]]),re={input:"v-input",number:"v-number",radio:"v-radio",checkbox:"v-checkbox","number-range":"v-number-range",date:"v-date",daterange:"v-date",time:"el-time-picker",datetime:"el-date-picker",datetimerange:"el-date-picker",slider:"el-slider",image:"v-upload",upload:"v-upload",file:"v-upload",transfer:"el-transfer",color:"el-color-picker",rate:"el-rate",select:"v-select",switch:"v-switch",json:"v-json","icon-select":"v-icon-select","sub-form":"v-sub-form",cascader:"v-cascader","cascader-panel":"v-cascader-panel",rule:"v-rule",filter:"v-filter",show:"v-show",editor:"monaco-editor",code:"monaco-editor",textarea:"el-input","point-checkbox":"v-point-checkbox",duration:"v-duration","table-select":"v-table-select"},wo={inline:!1,labelPosition:"right",labelWidth:"100px",submitButton:{show:!0,type:"primary",showText:"提交"},cancelButton:{show:!0,type:"info",showText:"取消"}};function ko(e){return e=e||{},me(e.submitButton)&&(e.submitButton={show:e.submitButton}),me(e.cancelButton)&&(e.cancelButton={show:e.cancelButton}),$.merge({},wo,e)}const ce={VSelect:Ct,VRadio:Wa,VCheckbox:Ja,VNumberRange:al,VJson:$t,VIconSelect:nl,VSubForm:cl,VUpload:St,VInput:_t,VCascader:kl,VCascaderPanel:Bt,VFilter:Bl,VShow:Tl,MonacoEditor:Me,VRule:At,VPointCheckbox:io,VNumber:Dt,VDuration:co,VDate:El,VTableSelect:bo,VSwitch:vo,ElTransfer:ra},Vo=e=>{Object.keys(e).forEach(t=>{ce[t]=e[t]})},Ne=e=>(e||(e="input"),re[e]!==void 0?re[e]:re["v-"+e]!==void 0?re["v-"+e]:e),Re=(e,t)=>{const a=e.props||{};return t&&t.disabled&&(a.disabled=!0),e.options&&(a.options=e.options),["file","image"].indexOf(e.type)>-1&&(a.action||(a.action="/upload"),a.type=e.type),e.readonly!==void 0&&(a.disabled=!!e.readonly,delete e.readonly),e.disabled!==void 0&&(a.disabled=!!e.disabled,delete e.disabled),e.type!=="color"&&(a.clearable=!0),e.type==="datetime"&&(a.type="datetime",a.format="YYYY-MM-DD HH:mm:ss",a.valueFormat="YYYY-MM-DD HH:mm:ss"),e.type==="date"&&(a.type="date",a.format=a.format||"YYYY-MM-DD",a.valueFormat=a.valueFormat||"YYYY-MM-DD"),e.type==="datetimerange"&&(a.type="datetimerange",a.format=a.format||"YYYY-MM-DD HH:mm:ss",a.valueFormat=a.valueFormat||"YYYY-MM-DD HH:mm:ss",a.startPlaceholder=(e.label||e.field).replace("开始时间","").replace("时间","")+"开始时间",a.endPlaceholder=(e.label||e.field).replace("结束时间","").replace("时间","")+"结束时间"),e.type==="daterange"&&(a.type="daterange",a.format=a.format||"YYYY-MM-DD",a.valueFormat=a.valueFormat||"YYYY-MM-DD",a.startPlaceholder=(e.label||e.field).replace("开始日期","").replace("日期","")+"开始日期",a.endPlaceholder=(e.label||e.field).replace("结束日期","").replace("日期","")+"结束日期"),e.type==="textarea"&&(a.type="textarea"),t&&!t.labelWidth&&(a.placeholder=e.label||e.field),a},jt=(e,t)=>{if(e.value!==void 0){if(e.type==="date"&&K(e.value)&&oa(e.value)){const{format:a}=Re(e,t);return Pa(sa(e.value)).format(a)}return e.value}};let Tt=()=>({});function Co(e){Tt=e}const $o=B({__name:"FormAction",props:{submiting:{type:Boolean,default:!1},formOptions:{type:Object,default:()=>{}},submitConfirm:{type:[Boolean,Object],default:!1}},emits:["submit","cancel"],setup(e,{emit:t}){const a=e,o=t,l=i=>o(i),s=z(()=>a.formOptions?.submitButton?.show===!0||a.formOptions?.cancelButton?.show===!0),n=()=>{const i={title:a.submitConfirm===!0?"确认提示":a.submitConfirm.title,message:a.submitConfirm===!0?"确认要提交吗?":a.submitConfirm.message};ht.confirm(i.message,i.title).then(()=>{l("submit")},()=>{})};return(i,u)=>{const d=q,b=De;return L(s)?(r(),c(b,{key:0},{default:p(()=>[e.formOptions.submitButton&&e.formOptions.submitButton.show?(r(),c(d,M({key:0,loading:e.submiting},e.formOptions.submitButton,{onClick:u[0]||(u[0]=m=>e.submitConfirm?n():l("submit"))}),{default:p(()=>[x(O(e.formOptions.submitButton.showText),1)]),_:1},16,["loading"])):V("",!0),e.formOptions.cancelButton&&e.formOptions.cancelButton.show?(r(),c(d,M({key:1},e.formOptions.cancelButton,{onClick:u[1]||(u[1]=m=>l("cancel"))}),{default:p(()=>[x(O(e.formOptions.cancelButton.showText),1)]),_:1},16)):V("",!0)]),_:1})):V("",!0)}}});ce.Warning=ft;const So=B({name:"FormItem",components:ce,props:{formOptions:{type:Object,default:()=>{}},item:{type:Object,default:()=>{}},modelValue:{type:[String,Number,Object,Array,Boolean],default:void 0},showLabel:{type:Boolean,default:!0},components:{type:Object,default:()=>{}},mod:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=_(e.modelValue),o=de(),l=_(e.item);if(l.value.type==="template"){l.value.type="v-tpl"+l.value.field;const s={};Object.keys(l.value.comp.methods||[]).forEach(n=>{s[n]=Function(`return ${l.value.comp.methods[n]}`)()}),o!==null&&(o.type.components["VTpl"+l.value.field]=$.merge({},l.value.comp,{data(){return{...l.value.comp.data}},methods:s}))}return{localValue:a,getComponentName:Ne,onFiledChange:(s,n)=>{t("update:modelValue",s,n)},compProps:(s,n)=>{const i=Re(s,n);return e.mod==="create"&&s.value===void 0&&(i.disabled=!1),i}}}}),_o=["innerHTML"],xo={style:{display:"flex","flex-direction":"column",width:"100%"}},Oo={key:0,class:"form-item-info"},Bo=["innerHTML"];function Ao(e,t,a,o,l,s){const n=ue,i=A("Warning"),u=Z,d=De;return Q((r(),c(d,{prop:e.item.field},ge({default:p(()=>[S("div",xo,[S("div",{class:U({"my-inline-form-item":e.formOptions?.inline})},[(r(),c(Y(e.getComponentName(e.item.type)),M({key:e.item.id||"",ref:"ctrl",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=b=>e.localValue=b)},e.compProps(e.item,e.$props.formOptions),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))],2),e.item.info&&!e.formOptions.inline?(r(),v("div",Oo,[f(u,{color:"#E6A23C"},{default:p(()=>[f(i)]),_:1}),t[2]||(t[2]=x()),S("span",{innerHTML:e.item.info},null,8,Bo)])):V("",!0)])]),_:2},[e.showLabel?{name:"label",fn:p(()=>[x(O(e.item.label||e.item.field)+" ",1),e.item.info&&e.formOptions.inline?(r(),c(n,{key:0,placement:"top"},{content:p(()=>[S("span",{innerHTML:e.item.info},null,8,_o)]),default:p(()=>[t[1]||(t[1]=S("i",{class:"el-icon-warning-outline"},null,-1))]),_:1})):V("",!0)]),key:"0"}:void 0]),1032,["prop"])),[[Vt,e.item.type!=="hidden"]])}const Et=D(So,[["render",Ao],["__scopeId","data-v-22b19f5f"]]),Pt=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"})),he={required:{required:!0,message:"该项为必填项",trigger:"blur"},string:{type:"string",message:"该项类型必须是字符串",trigger:"blur"},number:{type:"number",message:"该项类型必须是数字",trigger:"blur"},boolean:{type:"boolean",message:"该项类型必须是布尔",trigger:"blur"},integer:{type:"integer",message:"该项类型必须是整数",trigger:"blur"},float:{type:"float",message:"该项类型必须是浮点数",trigger:"blur"},array:{type:"array",message:"该项类型必须是数组",trigger:"blur"},enum:e=>({type:"enum",enum:e.split(","),message:"该项值必须在"+e+"中",trigger:"change"}),url:{type:"url",message:"请输入正确的url",trigger:"change"},email:{type:"email",message:"请输入正确的邮箱",trigger:"change"},regex:e=>({pattern:new RegExp(e),message:"该项格式必须符合"+e,trigger:"change"}),len:e=>({len:parseInt(e),message:`该项长度必须为${e}位`,trigger:"blur"}),min:e=>({min:parseInt(e),message:`该项长度至少为${e}位`,trigger:"blur"}),max:e=>({max:parseInt(e),message:`该项长度最多为${e}位`,trigger:"blur"}),required_if:(e,t,a)=>({validator:function(o,l,s){t[e]!==void 0&&String(l).length===0?s("该项为必填项"):s()},trigger:"blur"})};function Do(e,t,a){if(I(e))return e;if(X(e))return[e];if(K(e)){let o=[];typeof e=="string"&&(o=e.split("|"));const l=[];return o.forEach(s=>{if(s.indexOf(":")>-1){const n=s.split(":"),i=n[0],u=n[1];he[i]!==void 0?l.push(he[i](u,t,a)):console.warn("not support rule: "+i)}else he[s]!==void 0?l.push(he[s]):console.warn("not support rule: "+s)}),l}return[]}const jo=B({name:"VForm",components:{FormAction:$o,FormItem:Et,ElCard:ut},provide(){return{formData:this.formData,rootData:this.$props.rootData,dev:this.dev,mod:this.mod}},inheritAttrs:!1,props:{prefixPath:{type:String,default:""},isSub:{type:Boolean,default:!1},modelValue:{type:Object,default:e=>{}},formItems:{type:[Array,Function],default:()=>[]},infoApi:{type:String,default:""},getApi:{type:String,default:""},saveApi:{type:[String,Boolean],default:""},options:{type:Object,default:()=>({})},afterSubmit:{type:[String,Function],default:""},afterReset:{type:[String,Function],default:""},components:{type:Object,default:()=>({})},rootData:{type:Function,default:()=>({})},dev:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},enableCache:{type:Boolean,default:!1},initQueryParams:{type:Boolean,default:!0},mod:{type:String,default:""},submitPreCheck:{type:Function,default:()=>""},submitConfirm:{type:[Boolean,Object],default:!1}},emits:["submit","reset","fieldchange","update:modelValue","mounted","devAction"],data(){return{key:0,loading:!1,submiting:!1,errMsg:"",props:$.cloneDeep(this.$props),formData:Object.assign({},this.$props.modelValue),cacheFormData:Object.assign({},this.$props.modelValue),tmpFormData:Object.assign({},this.$props.modelValue),fieldMap:{},computeRules:[],formItemsSource:[],cacheItems:[],formOptions:{},dependMap:{fieldDependFields:{},dependFieldSourceFields:{}}}},computed:{formRules(){const e={};let t=this.$props.formItems;return H(this.$props.formItems)&&(t=this.$props.formItems(this.formData)),t.forEach(a=>{a.rules!==void 0&&this.canShow(a)&&(e[a.field]=Do(a.rules,this.formData,()=>this.$refs.formData))}),e},formItemsSection(){const e=[],t=this.formItemsSource.map(function(o,l){return o.index===void 0&&(o.index=`[${l}]`),o.type==="sub-form"&&o.props&&o.props["form-items"]&&(o.props["form-items"]=o.props["form-items"].map((s,n)=>(s.index===void 0&&(s.index=`[${l}].props.form-items[${n}]`),s))),o});t.forEach((o,l)=>{(l===0||o.section!==void 0)&&e.push(l)});const a=[];for(let o=0,l=1;e[o]!==void 0;o++,l++)a.push(t.slice(e[o],e[l]||t.length));return a.map(o=>{const l=this.layoutItem(o);return{name:l[0].items[0].section,children:l}})}},watch:{props:{handler(){const{formItems:e,options:t}=this.props,a=this.init($.cloneDeep(H(e)?e(this.$props.modelValue):e));Object.keys(a).forEach(o=>{o==="formData"?(this[o]=$.merge(this.formData,a[o]),this.cacheFormData=$.cloneDeep(this.formData)):this[o]=a[o]}),this.formOptions=ko(t||this.$props.options),setTimeout(this.computedInit,50)},immediate:!0}},mounted(){this.$watch(()=>this.rootData(),()=>{this.formItemsSource.forEach(e=>{if(e.depend?.field?.indexOf(".")!==0)return;const t=this.canShow(e);e.show!==t&&(e.show=this.canShow(e),e.id=ke())})},{deep:!0,immediate:!0}),this.$props.infoApi?(this.loading=!0,this.$http.request({method:"GET",url:this.$props.infoApi}).then(({data:e})=>{this.$props.infoApi!==""&&delete e.infoApi,this.$props.saveApi!==""&&delete e.saveApi,this.props=$.merge({},this.$props,e),this.loading=!1,this.key++,this.$emit("mounted",this.$refs.formData)})):this.$emit("mounted",this.$refs.formData),!this.$props.dev&&this.$props.getApi&&this.$http.request({method:"GET",url:this.$props.getApi}).then(({data:e})=>{const t=aa(e,this.formData);this.formData=Object.assign(this.formData,e),t.forEach(a=>{this.canShowPop(a,this.dependMap.dependFieldSourceFields[a]||[])}),this.key++})},methods:{async onenter(){this.$props.options?.inline&&await this.submitForm()},layoutItem(e){const t=[],a={isCard:!1,isRow:!0,items:[]};return e.forEach((o,l)=>{if(o.col=o.col||{span:24},o.col.span===24)t.push(Object.assign({},a,{items:[o]}));else if(t.length>0){const s=$.sum(t[t.length-1].items.map(n=>n.col.span));s<24&&s+o.col.span<=24?t[t.length-1].items.push(o):t.push(Object.assign({},a,{items:[o]}))}else t.push(Object.assign({},a,{items:[o]}))}),t},defaultValue(e){const t={};return e.forEach(a=>{if(a.value!==void 0&&(t[a.field]=a.value),a.type==="sub-form"){const o=this.defaultValue(a?.props?.formItems||[]);t[a.field]=a?.props?.repeat===!0?[o]:o}}),t},getQueryParams(){return ot(location.href)},getQueryObject(e){const t=this.initQueryParams?this.getQueryParams():{};Object.keys(t).forEach(o=>{o.indexOf("[]")>-1&&(t[o.replace("[]","")]=t[o],delete t[o])});const a={};return e.forEach(o=>{t[o.field]!==void 0&&(a[o.field]=this.parseType(o,t[o.field]))}),a},getFormData(e){const t={query:this.getQueryObject(e),default:this.defaultValue(e),model:this.$props.modelValue},a=["model","query","default"],o=[];a.reverse().forEach(s=>{o.push(t[s])});const l=$.merge(o[0],o[1],o[2]);return e.forEach(s=>{l[s.field]!==void 0&&(l[s.field]=this.parseType(s,l[s.field]))}),l},init(e){const t=this.getFormData(e),a={},o={};e.forEach(s=>{t[s.field]===void 0&&(t[s.field]=jt(s)),a[s.field]=s,s.computed!==void 0&&(o[s.field]=s.computed),s.props=this.getComponentProps(s),this.formOptions.column!==void 0&&(s.col={span:24/this.formOptions.column}),this.$props.disabled&&(s.props.disabled=!0),s.depend&&(I(s.depend)?s.depend:[s.depend]).forEach(n=>{this.dependMap.fieldDependFields[s.field]=this.dependMap.fieldDependFields[s.field]||[],this.dependMap.fieldDependFields[s.field].push(n.field),this.dependMap.dependFieldSourceFields[n.field]=this.dependMap.dependFieldSourceFields[n.field]||[],this.dependMap.dependFieldSourceFields[n.field].push(s.field)})});const l=null;return this.formData=t,e.forEach(s=>{s.show=this.canShow(s)}),{initData:$.cloneDeep($.merge(t,l)),fieldMap:a,computeRules:o,formItemsSource:e,cacheItems:$.cloneDeep(e)}},parseType(e,t){const a=t||e.value,o=Ge(a);let l=e.valueType;switch(e.options&&e.options[e.options.length-1]!==void 0&&(l=Ge(e.options[e.options.length-1]?.value)),e.type==="switch"&&(l="boolean"),l){case"number":return o==="array"?t.map(s=>(s+"").indexOf(".")>-1?parseFloat(s):parseInt(s)):(a+"").indexOf(".")>-1?parseFloat(a):parseInt(a);case"string":return a+"";case"boolean":return ta(a);default:return a}},async validate(){try{const e=this.$props.submitPreCheck(this.formData);if(e)return this.errMsg=e,!1;if(!await this.$refs.formData.validate())return!1;for(let t=0;t<this.formItemsSource.length;t++){const a=this.formItemsSource[t],o=this.$refs[a.field]?this.$refs[a.field][0]?.$refs?.ctrl?.validate:void 0;if(!(!a.show||!o)&&(ea(o)&&!await o()||H(o)&&!o()))return!1}return!0}catch(e){return console.error(e),!1}},async submitForm(e){if(!await this.validate())return xe("is-error"),console.warn("form validate result : false"),!1;if(!this.$props.saveApi){this.$emit("submit",this.formData);return}this.submiting=!0;const t={...this.formData};try{const a=await this.$http.request({method:"POST",url:this.$props.saveApi,data:t});let o=a.message;o==="0"&&(o=void 0),this.$message({type:"success",message:o||"保存成功"}),this.submiting=!1,setTimeout(l=>this.execAfter("afterSubmit"),1e3),this.$emit("submit",this.formData,a)}catch{this.submiting=!1}},resetForm(e){this.formData=$.cloneDeep(this.initData),this.$emit("update:modelValue",$.cloneDeep(this.initData)),this.$emit("reset"),setTimeout(t=>this.execAfter("afterReset"),1e3)},getComponentName(e){return re[e]||e},getComponentProps(e){const t=e.props||{};return e.options&&(t.options=e.options),t},canShow(e){let t=!0;const a=e.depend;return a&&(I(a)?a:[a]).forEach(o=>{let l=this.formData;o.field.indexOf(".")!==-1&&(l=this.rootData());const s=o.field.replace(/^\.+/,""),n=Zt(s,l);let i=(u,d)=>u===d;I(o.value)&&(I(n)?i=(u,d)=>u.filter(function(b){return d.indexOf(b)>-1}).length>0:i=(u,d)=>u.indexOf(d)>-1),i(o.value,n)||(t=!1)}),e.hide,t},canShowPop(e,t){t.forEach(a=>{const o=this.formItemsSource.findIndex(s=>s.field===a),l=this.canShow(this.formItemsSource[o]);this.formItemsSource[o].show=l,this.formItemsSource[o].id=ke(),l||(this.formData[a]=this.initData[a],(this.dependMap.dependFieldSourceFields[a]||[]).forEach(s=>{this.canShowPop(s,this.dependMap.dependFieldSourceFields[a]||[])}))})},onFiledChange(e,t,a){if(this.formData[e]=t,a){let s=!1;Object.keys(a).forEach(n=>{n!==e&&this.formData[n]!==a[n]&&(this.formData[n]=a[n],s=!0)}),s&&this.key++}this.canShowPop(e,this.dependMap.dependFieldSourceFields[e]||[]);var o;clearTimeout(o),o=setTimeout(()=>{this.computedWhen(e,t)},300),this.$emit("fieldchange",{field:e,value:t});const l=Ha(this.formData);delete l.__test__,this.$emit("update:modelValue",l)},computedInit(){Object.keys(this.formData).forEach(e=>{this.computedWhen(e,this.formData[e])})},execComputeRule(e,t,a,o,l=!1){let s=[];I(a)?I(a[0])||(s=[e,...a]):s=[e,"=",a];const n={};n[e]=t,Object.keys(o||[]).forEach(i=>{const u=$.findIndex(this.formItemsSource,{field:i});if(oe(n,s))this.formItemsSource[u]=$.merge(this.formItemsSource[u],o[i],{id:ke()}),o[i].value!==void 0&&(this.formData[i]=o[i].value,this.key++);else if(!l){const d=$.findIndex(this.cacheItems,{field:i});this.formItemsSource[u]=$.cloneDeep(this.cacheItems[d],{id:(this.formItemsSource[u]||0)+1});const b=this.cacheFormData[i]||this.cacheItems[d].value;o[i].value!==void 0&&b&&(this.formData[i]=b,this.key++)}})},computedWhen(e,t){const a=this.computeRules[e];if(a!==void 0){if(I(a)){a.forEach(o=>{this.execComputeRule(e,t,o.when,o.set||[],!0)});return}this.execComputeRule(e,t,a.when,a.set||[])}},execAfter(e){const t=this.props[e];if(t!==void 0){if(K(t))switch(this.props[e]){case"goback":this.$route&&this.$route.preHash?this.$router.push(this.$route.preHash):history.state.back&&history.back();break;case"reload":location.reload();break}H(t)&&t()}},onDevAction(e,t){this.$emit("devAction",e,t)}}});function To(e,t,a,o,l,s){const n=wa,i=A("form-item"),u=A("form-action"),d=W,b=G,m=Te,y=pt;return r(),v(T,null,[e.errMsg?(r(),c(n,{key:0,type:"error",style:{margin:"20px 40px"}},{default:p(()=>[x(O(e.errMsg),1)]),_:1})):V("",!0),e.formItemsSection.length>0?Q((r(),c(m,{ref:"formData",key:e.key,class:"v-form",model:e.formData,rules:e.formRules,"label-width":e.formOptions.labelWidth,inline:e.formOptions.inline,"label-position":e.formOptions.labelPosition,"validate-on-rule-change":!1,onKeyup:Ua(e.onenter,["enter"])},{default:p(()=>[f(b,null,{default:p(()=>[(r(!0),v(T,null,N(e.formItemsSection,(k,h)=>(r(),c(Y(e.formOptions.inline||h===0&&e.formItemsSection.length===1?"span":"el-card"),{key:"item-"+h,class:U(e.formOptions.inline?"form-section-inline":"form-section"),shadow:"never"},ge({default:p(()=>[(r(!0),v(T,null,N(k.children,(C,E)=>(r(),c(Y(e.formOptions.inline?"span":C.isRow?"el-row":"span"),{key:"section-"+h+"-"+E},{default:p(()=>[(r(!0),v(T,null,N(C.items,(j,g)=>(r(),c(Y(e.formOptions.inline?"span":"el-col"),{key:"each-"+g,span:j.col.span},{default:p(()=>[Q((r(),c(i,{key:j.id,ref_for:!0,ref:j.field,modelValue:e.formData[j.field],"onUpdate:modelValue":[w=>e.formData[j.field]=w,(w,P)=>e.onFiledChange(j.field,w,P)],devtool:"{devId: `${prefixPath}${each.index}`, dev: dev}","form-options":e.formOptions,components:e.components,item:j,"show-label":!!e.formOptions.labelWidth,mod:e.props.mod},null,8,["modelValue","onUpdate:modelValue","form-options","components","item","show-label","mod"])),[[Vt,j.type!=="hidden"&&j.show]])]),_:2},1032,["span"]))),128))]),_:2},1024))),128))]),_:2},[k.name?{name:"header",fn:p(()=>[S("span",null,O(k.name),1)]),key:"0"}:void 0]),1032,["class"]))),128)),e.formOptions.inline===!0?(r(),c(u,{key:0,submiting:e.submiting,"form-options":e.formOptions,"submit-confirm":e.submitConfirm,onSubmit:t[0]||(t[0]=k=>e.submitForm("formData")),onCancel:t[1]||(t[1]=k=>e.resetForm("formData"))},null,8,["submiting","form-options","submit-confirm"])):(r(),c(d,{key:1,span:24},{default:p(()=>[f(u,{submiting:e.submiting,"form-options":e.formOptions,"submit-confirm":e.submitConfirm,onSubmit:t[2]||(t[2]=k=>e.submitForm("formData")),onCancel:t[3]||(t[3]=k=>e.resetForm("formData"))},null,8,["submiting","form-options","submit-confirm"])]),_:1}))]),_:1})]),_:1},8,["model","rules","label-width","inline","label-position","onKeyup"])),[[y,e.loading]]):V("",!0)],64)}const He=D(jo,[["render",To],["__scopeId","data-v-64f81b9a"]]),It=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"})),Eo=Object.freeze(Object.defineProperty({__proto__:null,MonacoEditor:Me,VCascaderPanel:Bt,VForm:He,VInput:_t,VJson:$t,VRule:At,VSelect:Ct,VUpload:St,customFormComps:ce,getComponentName:Ne,regCustomFormComps:Vo,setUploadHeaderHandle:Co},Symbol.toStringTag,{value:"Module"})),Ft=["click","afterClick","apiError","apiSuccess","action","formReset","formSubmit"],Lt={props:{type:Object,default:()=>{}},metaData:{type:[Object,Function],default:()=>{}},injectData:{type:[Object,Function],default:()=>{}},dynamicExtra:{type:Function,default:e=>e},preCheck:{type:Function,default:()=>!0},container:{type:String,default:"dialog",validator:e=>["dialog","drawer"].indexOf(e)!==-1},containerProps:{type:Object,default:()=>{}},beforeCloseContainer:{type:Function,default:()=>()=>!0},confirm:{type:Boolean,default:!0}},tt={VForm:te(()=>Promise.resolve().then(()=>It)),VTable:te(()=>Promise.resolve().then(()=>qt)),VPlayer:te(()=>Promise.resolve().then(()=>zs))},Ue="__OKISS_VBTF_BASE_COMPS__",Ve=globalThis[Ue];Ve&&typeof Ve=="object"?Object.assign(Ve,tt):globalThis[Ue]=tt;const J=globalThis[Ue],Po={onclick(e,t,a,o,l){o?.actionHandler&&H(o?.actionHandler)?o?.actionHandler():setTimeout(()=>a.emit("action"),200),l()}},Io={onclick(e,t){const a=e();if(/http.*/.test(a))window.open(a);else{if(!t.$router){console.error("you must set : app.config.globalProperties.$router = createRouter()");return}t.$router.push(a).then()}}},Fo={onclick(e,t,a,o,l){if(!t.$http){console.error("you must set : app.config.globalProperties.$http = axios.create()");return}const s={url:e,...o};if(o.sourceData!==void 0&&X(o.sourceData)){const i={};Object.keys(o.sourceData).forEach(u=>{const d=$.get(o.metaData||{},o.sourceData[u]);i[u]=d}),s.data={...s.data||{},...i}}let n=null;o.isGrup&&(n=it.service({lock:!0,text:"正在提交",background:"rgba(0, 0, 0, 0.7)"})),t.$http.request(s).then(i=>{a.emit("apiSuccess",i),l(),o.isGrup&&n&&n.close(),Ee({message:i?.data?.message||"操作成功",type:"success",duration:5*1e3})}).catch(i=>{o.isGrup&&n&&n.close(),a.emit("apiError",i),l()}).finally(()=>{o.isGrup&&n&&n.close(),l()})},getSubProps(e,t){return e.infoApi&&(e.infoApi=F(e.infoApi,t)),e}},Lo={onclick(e,t,a,o,l){l()},getSubComp(){return J.VForm||"VForm"},getSubProps(e,t){Object.keys(e).forEach(s=>{/.*Api$/.test(s)&&(e[s]=F(e[s],{...t,...t.$row}))});const a={},o=H(e.formItems)?e.formItems(t):e.formItems||[],l=t||{};return o.forEach(s=>{l&&l[s.field]!==void 0&&(a[s.field]=l[s.field])}),{...e},{modelValue:a,...e}},getSubEvent(e,t,a,o){return{submit(l,s){s&&s.code!==0||(a.value=!1,o?.actionHandler&&H(o?.actionHandler)?o?.actionHandler(l):setTimeout(()=>t.emit("action"),200))},reset(){a.value=!1}}}},Mo={onclick(e,t,a,o,l){l()},getSubComp(e={}){const t=e?.type;return t?typeof t=="string"&&J[t]||t:""},getSubProps(e={},t){const a={},o=t||{};return Object.keys(e||{}).forEach(l=>{/.*Api$/.test(l)?a[l]=F(e[l],o):l!=="type"&&(a[l]=e[l])}),a.metaData=t,a},getSubEvent(e,t,a){return{}}},No={onclick(e,t,a,o,l){l()},getSubComp(){return J.VTable||"VTable"},getSubProps(e,t){return Object.keys(e).forEach(a=>{/.*Api$/.test(a)&&(e[a]=F(e[a],t))}),e},getSubEvent(e,t,a){return{reset(){a.value=!1,"reset"in e.extra&&e.extra.reset&&e.extra?.reset()},submit(o){"submit"in e.extra&&e.extra.submit&&e.extra?.submit(o)}}}},_e={jump:Io,api:Fo,form:Lo,table:No,modal:Mo,base:Po};function Mt(e,t){let a={"append-to-body":!0,"destroy-on-close":!0};return e==="dialog"&&(a={width:"80%",...a}),e==="drawer"&&(a={size:"80%",...a}),{...a,...t.containerProps}}function Ro(e){Object.keys(e).forEach(t=>{J[t]=e[t]})}const Ho=B({name:"VButton",components:{...J,ElDialog:ie,ElDrawer:rt},props:{type:{type:String,default:"",validator:e=>["jump","api","form","table","modal","","base"].includes(e)},target:{type:String,default:""},text:{type:String,default:void 0},extra:{type:Object,default(){return{}}},...Lt},emits:Ft,setup(e,t){const a=de(),o=a.appContext.config.globalProperties,l=_(!1),s=_e[e.type||"base"];if(!s)return console.error(`您所配置的 button.type=${e.type} 不存在, 仅支持`+Object.keys(_e).join(", ")),{};const n=()=>H(e.metaData)?e.metaData():e.metaData,i=()=>H(e.injectData)?e.injectData(e.extra):e.injectData,u=g=>{if(j.value=!0,t.emit("click",g),!e.preCheck(e))return;const w=()=>F(e.target||"",n());let P=e.extra||{};P.url===void 0&&(P.url=e.target),P=e.dynamicExtra({...P});const ae=i();P.method===void 0||P.method==="GET"?P.params=$.merge(P.params,ae):P.data=$.merge(P.data,ae);const R={...P,metaData:n()};Object.keys(R).forEach(le=>{K(R[le])&&(R[le]=F(R[le],n()))}),s.onclick(w,o,t,R,()=>{["modal","form","table"].indexOf(e.type)>-1&&(l.value=!0),["api"].indexOf(e.type)>-1&&t.emit("action"),j.value=!1})},d=z(()=>F(e.text||"",n())),b=_({}),m=Se("span"),y=_({}),k=_({}),h=g=>{if(!g)return"";if(typeof g=="string"){const w=g.trim();return w?/^[a-z]/.test(w)?w:J[w]?J[w]:a?.appContext?.components?.[w]?w:(console.error(`[VButton] schema 中定义的组件 ${w} 未找到，请确认已注册。`),""):""}return g};be(()=>l.value,()=>{b.value=Mt(e.container,e);const g=s.getSubComp?s.getSubComp(e.extra||{}):"span";m.value=h(g),y.value=s.getSubProps?s.getSubProps(e.extra,n()):{},y.value,k.value=s.getSubEvent?s.getSubEvent(e,t,l,e.extra):{}});const C=()=>{e.beforeCloseContainer()&&(l.value=!1)},E=()=>{l.value=!1},j=_(!1);return{clickHandler:u,relText:d,showContainer:l,containerProps:b,beforeClose:C,xsubComp:m,xsubProps:y,xsubEvent:k,closeModal:E,transBtnProps:g=>{if(g&&g.icon&&K(g.icon)){const w=lt(g.icon.replace("el-icon-",""),"-");g.icon=Se(yt[w])}return g=g||{},g.loading=j.value,g}}}}),Uo={class:"v-btn"};function zo(e,t,a,o,l,s){const n=q,i=ga;return r(),v("span",Uo,[e.$props.type==="api"&&e.confirm?(r(),c(i,{key:0,title:"确定要"+(e.relText?e.relText:"操作")+"吗",onConfirm:e.clickHandler},{reference:p(()=>[e.relText?(r(),c(n,fe(M({key:0},e.transBtnProps(e.$props.props))),{default:p(()=>[x(O(e.relText),1)]),_:1},16)):(r(),c(n,fe(M({key:1},e.transBtnProps(e.$props.props))),null,16))]),_:1},8,["title","onConfirm"])):(r(),v(T,{key:1},[e.relText?(r(),c(n,M({key:0},e.transBtnProps(e.$props.props),{onClick:e.clickHandler}),{default:p(()=>[x(O(e.relText),1)]),_:1},16,["onClick"])):(r(),c(n,M({key:1},e.transBtnProps(e.$props.props),{onClick:e.clickHandler}),null,16,["onClick"]))],64)),e.showContainer?(r(),c(Y("el-"+e.container),M({key:2,modelValue:e.showContainer,"onUpdate:modelValue":t[0]||(t[0]=u=>e.showContainer=u)},e.containerProps,{"before-close":e.beforeClose,title:e.relText}),{default:p(()=>[ee(e.$slots,"default"),e.xsubComp!==""?(r(),c(Y(e.xsubComp),M({key:0},e.xsubProps,kt(e.xsubEvent)),null,16)):V("",!0)]),_:3},16,["modelValue","before-close","title"])):V("",!0)])}const se=D(Ho,[["render",zo]]),qo={splitButton:!1},Ko=B({name:"VButtonGroup",components:{...J,ArrowDown:ja,ElDialog:ie,ElDrawer:rt},props:{buttons:{type:Array,default:()=>[]},text:{type:String,default:"更多"},...Lt},emits:Ft,setup(e,t){const a=de(),o=a.appContext.config.globalProperties,l={...qo,...e.props},s=g=>F(g,e.metaData),n=_(void 0),i=_(!1),u=z(()=>e.buttons?.length>0?s(e.buttons[0].text||""):""),d=_(null),b=g=>{if(g=g-1,!e.preCheck(e))return;const w=e.buttons[g],P=()=>H(w["meta-data"])?w["meta-data"]():w["meta-data"],ae=()=>F(w.target||"",P());d.value=_e[w.type||"base"];let R=w.extra||{};R.url===void 0&&(R.url=w.target);const le=H(w["inject-data"])?w["inject-data"](R):w["inject-data"];R=H(w["dynamic-extra"])?w["dynamic-extra"]({...R}):R,R.method===void 0||R.method==="GET"?R.params=$.merge(R.params,le):R.data=$.merge(R.data,le);const ne={...R},Kt=P();Object.keys(ne||{}).forEach(ve=>{K(ne[ve])&&(ne[ve]=F(ne[ve],Kt||{}))}),d.value.onclick(ae,o,t,{...ne,isGrup:!0},()=>{n.value=g,["modal","form","table"].indexOf(w.type)>-1&&(i.value=!0),["api"].indexOf(w.type)>-1&&t.emit("action"),H(e.buttons[g].onClick)&&e.buttons[g].onClick(g)})},m=()=>{e.beforeCloseContainer()&&(i.value=!1)},y=z(()=>{const g=e.buttons[n.value];return s(g.text||"")}),k=_({}),h=Se("span"),C=_({}),E=_({}),j=g=>{if(!g)return"";if(typeof g=="string"){const w=g.trim();return w?/^[a-z]/.test(w)?w:J[w]?J[w]:a?.appContext?.components?.[w]?w:(console.error(`[VButtonGroup] schema 中定义的组件 ${w} 未找到，请确认已注册。`),""):""}return g};return be(()=>n.value,()=>{const g=e.buttons[n.value];k.value=Mt(e.container,e);const w=H(g["meta-data"])?g["meta-data"]():g["meta-data"],P=d.value&&d.value.getSubComp?d.value.getSubComp(g.extra||{}):"span";h.value=j(P),C.value=d.value&&d.value.getSubProps?d.value.getSubProps(g.extra,w):{},E.value=d.value&&d.value.getSubEvent?d.value.getSubEvent(g,t,i):{}}),{dropProps:l,showText:u,replaceText:s,clickHandle:b,showContainer:i,containerProps:k,beforeClose:m,xsubComp:h,xsubProps:C,xsubEvent:E,containerTitle:y,openFullScreen2:()=>{const g=it.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(()=>{g.close()},2e3)}}}}),Yo={class:"v-btn"};function Go(e,t,a,o,l,s){const n=A("arrow-down"),i=Z,u=q,d=ba,b=fa,m=ya;return r(),v("span",Yo,[f(m,M(e.dropProps,{onCommand:e.clickHandle}),{dropdown:p(()=>[f(b,null,{default:p(()=>[(r(!0),v(T,null,N(e.buttons,(y,k)=>(r(),c(d,{key:k+"button-group",command:k+1},{default:p(()=>[x(O(y.text),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:p(()=>[e.dropProps.splitButton?(r(),v(T,{key:0},[x(O(e.text),1)],64)):(r(),c(u,{key:1,type:e.dropProps.type},{default:p(()=>[x(O(e.text)+" ",1),f(i,{class:"el-icon--right"},{default:p(()=>[f(n)]),_:1})]),_:1},8,["type"]))]),_:1},16,["onCommand"]),e.showContainer?(r(),c(Y("el-"+e.container),M({key:0,modelValue:e.showContainer,"onUpdate:modelValue":t[0]||(t[0]=y=>e.showContainer=y)},e.containerProps,{"before-close":e.beforeClose,title:e.containerTitle}),{default:p(()=>[(r(),c(Y(e.xsubComp),M(e.xsubProps,kt(e.xsubEvent)),null,16))]),_:1},16,["modelValue","before-close","title"])):V("",!0)])}const Nt=D(Ko,[["render",Go]]),Wo=B({components:{VButton:se,VButtonGroup:Nt},inject:{dev:{from:"dev",default:!1}},props:{buttons:{type:Array,default:()=>[]},prefixPath:{type:String,default:""}},emits:["click","action"],data(){return{localButton:[]}},watch:{buttons:{deep:!0,immediate:!0,handler(e,t){const a=[];this.$props.buttons.forEach(o=>{delete o.when,a.push(o)}),this.localButton=a}}},methods:{isArray(e){return I(e)},onclick(e){this.$emit("click",e)},onaction(e){this.$emit("action",e)}}});function Jo(e,t,a,o,l,s){const n=A("v-button-group"),i=A("v-button");return r(!0),v(T,null,N(e.localButton,(u,d)=>(r(),v(T,{key:d+"v-button"},[e.isArray(u)?(r(),c(n,M({key:0,devtool:"{devId: `${prefixPath}[${index}]`, dev: dev}"},{ref_for:!0},{buttons:u},{onClick:e.onclick,onAction:e.onaction}),null,16,["onClick","onAction"])):(r(),c(i,M({key:1,devtool:"{devId: `${prefixPath}[${index}]`, dev: dev}"},{ref_for:!0},u,{onClick:e.onclick,onAction:e.onaction}),null,16,["onClick","onAction"]))],64))),128)}const ze=D(Wo,[["render",Jo]]);function Qo(e,t=!0){let a="";return $.cloneDeep(e).reverse().forEach((o,l)=>{l<2&&o.meta?.title&&(a=o.meta.title+(a&&"-"+a))}),a}class Xo{SheetNames=[];Sheets={}}const Zo=e=>(+e-+new Date(Date.UTC(1899,11,30)))/(1440*60*1e3),es=e=>{const t={},a={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let o=0;o!==e.length;++o)for(let l=0;l!==e[o].length;++l){a.s.r>o&&(a.s.r=o),a.s.c>l&&(a.s.c=l),a.e.r<o&&(a.e.r=o),a.e.c<l&&(a.e.c=l);const s={v:e[o][l],t:"",z:""};if(s.v==null)continue;const n=$e.encode_cell({c:l,r:o});typeof s.v=="number"?s.t="n":typeof s.v=="boolean"?s.t="b":s.v instanceof Date?(s.t="n",s.z=La.get_table()[14],s.v=Zo(s.v)):s.t="s",t[n]=s}return a.s.c<1e7&&(t["!ref"]=$e.encode_range(a)),t},ts=e=>{const t=new ArrayBuffer(e.length),a=new Uint8Array(t);for(let o=0;o!==e.length;++o)a[o]=e.charCodeAt(o)&255;return t},Rt=(e,t,a="excel-list",o=[],l=[],s=!0,n="xlsx")=>{t.unshift(e);for(let m=o.length-1;m>-1;m--)t.unshift(o[m]);const i="SheetJS",u=new Xo,d=es(t);if(l.length>0&&(d["!merges"]||(d["!merges"]=[]),l.forEach(m=>{d["!merges"].push($e.decode_range(m))})),s){const m=t.map(k=>k.map(h=>h==null?{wch:10}:h.toString().charCodeAt(0)>255?{wch:h.toString().length*2}:{wch:h.toString().length})),y=m[0];for(let k=1;k<m.length;k++)for(let h=0;h<m[k].length;h++)y[h].wch<m[k][h].wch&&(y[h].wch=m[k][h].wch);d["!cols"]=y}u.SheetNames.push(i),u.Sheets[i]=d;const b=Fa(u,{bookType:n,bookSST:!1,type:"binary"});Ia.saveAs(new Blob([ts(b)],{type:"application/octet-stream"}),`${a}.${n}`)},as=B({name:"ExportAddButton",props:{getInfo:{type:Function,default:void 0}},data(){return{dialogVisible:!1,task:{page:1,size:20,total:200}}},computed:{percentage(){return(this.task.page/Math.ceil(this.task.total/this.task.size)&&1)*100}},methods:{async execute(){const e=this.$props.getInfo();this.task=Object.assign(this.task,e);let t=[];const a=[],o=[];for(e.header.forEach(l=>{a.push(l.label),o.push(l.field)}),this.dialogVisible=!0;this.task.page<=Math.ceil(this.task.total/this.task.size);){const l=Object.assign({_page:e.page||1,_size:e.size||20},e.filter||{}),{data:s}=await this.$http.request({method:"GET",url:e.listApi,params:l}),n=[];(s.list||[]).forEach(i=>{const u=[];o.forEach(d=>{u.push(i[d])}),n.push(u)}),t=s.list.concat(n),this.task.page++,this.task.total=s.page.count}Rt(a,t,e.name),this.$message.success("文件导出成功"),this.dialogVisible=!1}}});function ls(e,t,a,o,l,s){const n=q,i=$a,u=ie;return r(),v(T,null,[f(n,{type:"primary",onClick:e.execute},{default:p(()=>[...t[1]||(t[1]=[x("导出",-1)])]),_:1},8,["onClick"]),f(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=d=>e.dialogVisible=d),title:"提示",width:"30%"},{default:p(()=>[f(i,{percentage:e.percentage},null,8,["percentage"])]),_:1},8,["modelValue"])],64)}const os=D(as,[["render",ls]]),ss=B({__name:"emum",props:{data:{type:[String,Number,Array],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},when:{type:Array,default:()=>[]}},setup(e){const t=e,{column:a,data:o}=Ra(t),l=z(()=>I(o?.value)?o?.value:[o?.value]),s=["success","info","warning","danger","primary"],n=d=>{const b=(a.value?.state||{})[d]??d,m=String(b);return s.includes(m)?m:"info"},i=d=>{if(d==="")return"";const b=$.findIndex(a.value?.options,{value:d}),m=a.value.options?a.value.options[b]:!1;return m?m.label:d},u=z(()=>{const d=t.when;return d.length===0?!0:oe({data:o?.value},["data",...d])});return(d,b)=>{const m=Be;return L(u)?(r(!0),v(T,{key:0},N(L(l).filter(y=>i(y)!==""),(y,k)=>(r(),c(m,{key:k,type:n(y)},{default:p(()=>[x(O(i(y)),1)]),_:2},1032,["type"]))),128)):V("",!0)}}}),ns={name:"CellSpan",props:{data:{type:String,default:""},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},rs=["innerHTML"];function is(e,t,a,o,l,s){return r(),v("span",{innerHTML:a.data},null,8,rs)}const us=D(ns,[["render",is]]),ds={name:"CellImage",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},ps={class:"image-item"};function cs(e,t,a,o,l,s){const n=nt;return r(),v("div",ps,[a.data?(r(),c(n,{key:0,lazy:!0,class:"cell-image",src:a.data,"preview-src-list":[a.data]},null,8,["src","preview-src-list"])):V("",!0)])}const hs=D(ds,[["render",cs],["__scopeId","data-v-d715bbc6"]]),ms=B({__name:"link",props:{link:{type:String,default:""},data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},extraData:{type:Object,default:()=>{}}},setup(e){const t=e;ye(()=>{});const a=z(()=>$.merge({type:"primary",href:t.data,target:"_blank"},t.column.props||{})),o=z(()=>$.merge({type:"primary",href:F(t.link,{...t.row,...t.extraData}),target:"_blank"},t.column.props||{}));return(l,s)=>{const n=ma;return e.link==""?(r(),c(n,fe(M({key:0},L(a))),{default:p(()=>[x(O(e.column.label),1)]),_:1},16)):(r(),c(n,fe(M({key:1},L(o))),{default:p(()=>[x(O(e.data),1)]),_:1},16))}}}),fs={name:"JsonView",props:{data:{type:[Object,Array],required:!0},jsonKey:{type:String,default:""},closed:{type:Boolean,default:!1},isLast:{type:Boolean,default:!0},fontSize:{type:Number,default:14},lineHeight:{type:Number,default:24},deep:{type:Number,default:3},currentDeep:{type:Number,default:1},iconStyle:{type:String,default:"circle"},iconColor:{type:Array,default(){return[]}},theme:{type:String,default:""},hasSiblings:{type:Boolean,default:!0},tools:{type:Boolean,default:!0}},data(){return{innerclosed:this.closed,templateDeep:this.currentDeep,visible:!1}},computed:{isArray(){return this.getDataType(this.data)==="array"},length(){return this.isArray?this.data.length:Object.keys(this.data).length},subfix(){const e=this.data;return this.isEmptyArrayOrObject(e)?"":(this.isArray?"]":"}")+(this.isLast?"":",")},prefix(){return this.isArray?"[":"{"},items(){const e=this.data;return this.isArray?e.map(t=>{const a=this.isObjectOrArray(t);return{value:t,isJSON:a,key:""}}):Object.keys(e).map(t=>{const a=e[t],o=this.isObjectOrArray(a);return{value:a,isJSON:o,key:t}})},iconColors(){const{theme:e,iconColor:t}=this;return t.length===2?t:e==="one-dark"?["#747983","#747983"]:e==="vs-code"?["#c6c6c6","#c6c6c6"]:["#747983","#747983"]}},watch:{closed(){this.innerclosed=this.closed}},mounted(){setTimeout(()=>{this.visible=!0},0)},methods:{getDataType(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},isObjectOrArray(e){return["array","object"].includes(this.getDataType(e))},toggleClose(){this.length!==0&&(this.innerclosed=!this.innerclosed)},isClose(){return this.templateDeep+1>this.deep},isEmptyArrayOrObject(e){return[{},[]].map(t=>JSON.stringify(t)).includes(JSON.stringify(e))},copy(){at(JSON.stringify(this.data,null,2))}}},bs={key:0,class:"json-view-tool"},ys={class:"content-wrap"},gs={key:0,class:"json-key"},vs={key:1},ws={class:"json-note"},ks={key:2},Vs={key:0,class:"json-body"},Cs={key:1,class:"json-item"},$s={class:"json-key"},Ss={key:0,class:"base-line"},_s={key:1,class:"last-line"};function xs(e,t,a,o,l,s){const n=ue,i=A("json-view");return r(),v(T,null,[a.tools?(r(),v("div",bs,[f(n,{content:"复制"},{default:p(()=>[S("i",{class:"el-icon-copy-document",onClick:t[0]||(t[0]=(...u)=>s.copy&&s.copy(...u))})]),_:1})])):V("",!0),l.visible?(r(),v("div",{key:1,class:U(["json-view-container",a.theme,`deep-${a.currentDeep}`])},[S("div",{class:U(["json-view",s.length?"closeable":""]),style:Fe({fontSize:a.fontSize+"px",lineHeight:a.lineHeight+"px"})},[s.length&&a.iconStyle==="square"?(r(),v("span",{key:0,class:"angle",onClick:t[1]||(t[1]=(...u)=>s.toggleClose&&s.toggleClose(...u))},[S("i",{class:U("el-icon-"+(l.innerclosed?"plus":"minus"))},null,2)])):V("",!0),s.length&&a.iconStyle==="circle"?(r(),v("span",{key:1,class:"angle",onClick:t[2]||(t[2]=(...u)=>s.toggleClose&&s.toggleClose(...u))},[S("i",{class:U("el-icon-"+(l.innerclosed?"circle-plus-outline":"remove-outline"))},null,2)])):V("",!0),s.length&&a.iconStyle==="triangle"?(r(),v("span",{key:2,class:"angle",onClick:t[3]||(t[3]=(...u)=>s.toggleClose&&s.toggleClose(...u))},[S("i",{class:U("el-icon-"+(l.innerclosed?"caret-right":"el-icon-caret-bottom"))},null,2)])):V("",!0),S("div",ys,[S("p",{class:U(["first-line",s.length>0?"pointer":""]),onClick:t[4]||(t[4]=(...u)=>s.toggleClose&&s.toggleClose(...u))},[a.jsonKey?(r(),v("span",gs,'"'+O(a.jsonKey)+'": ',1)):V("",!0),s.length?(r(),v("span",vs,[x(O(s.prefix)+O(l.innerclosed?"..."+s.subfix:"")+" ",1),S("span",ws,O(l.innerclosed?s.length+" items":""),1)])):V("",!0),t[5]||(t[5]=x()),s.length?V("",!0):(r(),v("span",ks,O(`${s.isArray?"[]":"{}"}${a.isLast?"":","}`),1))],2),!l.innerclosed&&s.length?(r(),v("div",Vs,[(r(!0),v(T,null,N(s.items,(u,d)=>(r(),v(T,{key:d},[u.isJSON?(r(),c(i,{key:0,closed:s.isClose(),data:u.value,"json-key":u.key,"current-deep":l.templateDeep+1,deep:a.deep,"icon-style":a.iconStyle,theme:a.theme,"font-size":a.fontSize,"line-height":a.lineHeight,"icon-color":s.iconColors,"is-last":d===s.items.length-1,"has-siblings":u.hasSiblings,tools:!1},null,8,["closed","data","json-key","current-deep","deep","icon-style","theme","font-size","line-height","icon-color","is-last","has-siblings"])):(r(),v("p",Cs,[S("span",$s,O(s.isArray?"":'"'+u.key+'":'),1),S("span",{class:U(["json-value",s.getDataType(u.value)])},O(`${s.getDataType(u.value)==="string"?'"':""}${u.value}${s.getDataType(u.value)==="string"?'"':""}${d===s.items.length-1?"":","}`),3)]))],64))),128)),l.innerclosed?V("",!0):(r(),v("span",Ss))])):V("",!0),l.innerclosed?V("",!0):(r(),v("p",_s,[S("span",null,O(s.subfix),1)]))])],6)],2)):V("",!0)],64)}const Ht=D(fs,[["render",xs],["__scopeId","data-v-713b0e7b"]]),Os=B({__name:"json",props:{data:{type:[Object,String,Array],default:()=>{}},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,a=z(()=>K(t.data)?JSON.parse(t.data):t.data);return(o,l)=>(r(),c(se,{type:"modal",text:"查看"},{default:p(()=>[f(Ht,{data:L(a)},null,8,["data"])]),_:1}))}}),Bs=B({__name:"span",props:{data:{type:[String,Number,Array,Object],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},render:{type:String,default:""},scope:{type:Object,default:()=>{}}},setup(e){const t=e,a=z(()=>t.render?new Function("return "+t.render)()(t.data,t.row):t.data);return(o,l)=>(r(),v("span",null,O(L(a)),1))}}),As={name:"CellRichText",functional:!0,props:{data:{type:[String,Number,Array],default:""},row:{type:Object,default:()=>{}}},setup(e){let t=e.data;const a=function(l){const s=/<([\s\S]*?)>/g;let n=s.exec(l);const i=[];for(;n!=null;)i.push(RegExp.$1),n=s.exec(l);return i};(typeof t=="string"||typeof t=="number")&&(t=[t]);const o=[];for(let l=0;l<t.length;l++){const s=a(t[l]),n={};let i=t[l];for(let u=0;u<s.length;u++){const d=i.split("<"+s[u]+">");o.push(f("span",null,[d[0]]));const b=s[u].split("|");let m={color:void 0,background:void 0};b[1]!==void 0&&(m.color=b[1]),b[2]!==void 0&&(m.background=b[2]),m=Object.assign({},n,m),o.push(f("span",{class:"el-tag el-tag--mini",style:m},[b[0]])),i=d[1]}o.push(f("span",null,[i])),l<t.length-1&&o.push(f("br",null,null))}return()=>f("div",null,[o])}},Ds=B({__name:"icon",props:{data:{},row:{},scope:{}},setup(e){return(t,a)=>{const o=A("v-icon");return r(),c(o,{name:t.data},null,8,["name"])}}}),js={key:0},Ts=["innerHTML"],Es=B({__name:"tpl",props:{data:{type:[String,Number,Array,Object],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},tpl:{type:String,default:""},interval:{type:Number,default:0},api:{type:Object,default:void 0},scope:{type:Object,default:()=>{}},extraData:{type:Object,default:()=>{}}},setup(e){const{$http:t}=Le(),a=e,o=_("");let l;const s=_(!1);return ye(()=>{if(o.value=F(a.tpl,{...a.row,...a.extraData}),a.api===void 0)return;const n={url:"",method:"GET",...a.api,data:a.row};n.url=F(n.url,{...a.row,...a.extraData});const i=()=>{s.value=!0,t?.request(n).then(u=>{o.value=F(a.tpl,{...u.data,...a.extraData,resp:u.data}),a.tpl,{...u.data,...a.extraData,resp:u.data},s.value=!1}).catch(u=>{s.value=!1})};i(),a.interval>0&&(l=setInterval(i,a.interval))}),wt(()=>{clearInterval(l)}),(n,i)=>{const u=Z;return L(s)?(r(),v("span",js,[f(u,{class:"is-loading"},{default:p(()=>[f(L(Aa))]),_:1})])):(r(),v("span",{key:1,innerHTML:L(o)},null,8,Ts))}}}),Ps={__name:"view",props:{fields:{type:Array,default:()=>[]},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,a=z(()=>{if(t.fields?.length===0)return t.row;const o={};return t.fields?.forEach(l=>{o[l]=t.row[l]}),o});return(o,l)=>(r(),c(se,{type:"modal",text:"查看"},{default:p(()=>[f(Ht,{data:L(a)},null,8,["data"])]),_:1}))}},Is={name:"VChart",props:{options:{type:Object,default:()=>{}}},setup(e){const t=_(null),a=null;Ie(()=>{o()});const o=la(()=>a.value.resize(),200);return gt(()=>{window.removeEventListener("resize",o)}),{chartDom:t,chart:a}}},Fs={ref:"chartDom",class:"chart",style:{height:"100%",width:"100%"}};function Ls(e,t,a,o,l,s){return r(),v("div",Fs,null,512)}const Ms=D(Is,[["render",Ls]]),Ns=B({__name:"chart",props:{data:{type:Array,default:()=>[]},column:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},options:{type:Object,default:()=>{}},noDataText:{type:String,default:"暂无数据"},row:{type:Object,default:()=>{}}},setup(e){const t=e,a={title:{text:""},tooltip:{trigger:"axis"},grid:{left:"2%",right:"2%",bottom:"5%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value"}},o=z(()=>{const l=$.cloneDeep($.merge({series:[]},t.options,a));return t.data?.forEach(s=>{l.xAxis.data.push(s[0]),s.forEach((n,i)=>{i>0&&(l.series[i-1].data=l.series[i-1].data||[],l.series[i-1].data.push(n))})}),l});return(l,s)=>{const n=W,i=G;return t.data.length>0?(r(),c(se,{key:0,type:"modal",text:"查看"},{default:p(()=>[f(i,null,{default:p(()=>[f(n,null,{default:p(()=>[f(Ms,{options:L(o)},null,8,["options"])]),_:1})]),_:1})]),_:1})):V("",!0)}}}),Rs=B({name:"VPlayer",props:{playurl:{type:String,default:""},playApi:{type:String,default:""}},data(){return{loading:!1,localPlayUrl:this.$props.playurl}},beforeCreate(){this.$props.playApi&&this.$http.request({url:this.$props.playApi}).then(({data:e})=>{this.localPlayUrl=e.playurl})}}),Hs=["src"];function Us(e,t,a,o,l,s){return e.localPlayUrl?(r(),v("video",{key:e.localPlayUrl,src:e.localPlayUrl,controls:"controls",preload:"",autoplay:"autoplay",style:{width:"100%",height:"500px"}},null,8,Hs)):V("",!0)}const Ut=D(Rs,[["render",Us]]),zs=Object.freeze(Object.defineProperty({__proto__:null,default:Ut},Symbol.toStringTag,{value:"Module"})),qs={name:"CellPlayer",components:{VPlayer:Ut},props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},Ks={class:"image-item"};function Ys(e,t,a,o,l,s){const n=A("v-player");return r(),v("div",Ks,[f(n,{playurl:a.data},null,8,["playurl"])])}const Gs=D(qs,[["render",Ys]]),Ws={key:1},Js={inheritAttrs:!1},Qs=B({...Js,__name:"sortIndex",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},ctrl:{type:Boolean,default:!1},scope:{type:Object,default:()=>{}}},emits:["sortIndexChange"],setup(e,{emit:t}){const a=e,o=_(a.scope.$index+1),l=_(!1),s=t,n=()=>{new Date().getTime(),s("sortIndexChange",{from:a.scope.$index,to:o.value-1}),l.value=!1};return(i,u)=>{const d=W,b=q,m=G;return L(l)?(r(),v("span",Ws,[f(m,{gutter:10},{default:p(()=>[f(d,{span:18},{default:p(()=>[f(Dt,{modelValue:L(o),"onUpdate:modelValue":u[1]||(u[1]=y=>pe(o)?o.value=y:null),props:{controls:!1},style:{width:"auto"}},null,8,["modelValue"])]),_:1}),f(d,{span:6},{default:p(()=>[f(b,{icon:L(Da),type:"success",circle:"",onClick:n},null,8,["icon"])]),_:1})]),_:1})])):(r(),v("span",{key:0,style:{display:"inline-block",width:"100%"},onClick:u[0]||(u[0]=y=>l.value=!L(l))},O(L(o)),1))}}}),Xs=Object.freeze(Object.defineProperty({__proto__:null,CellChart:Ns,CellEnum:ss,CellHtml:us,CellIcon:Ds,CellImage:hs,CellJson:Os,CellLink:ms,CellPlayer:Gs,CellRichText:As,CellSortIndex:Qs,CellSpan:Bs,CellTpl:Es,CellView:Ps},Symbol.toStringTag,{value:"Module"})),Zs=B({name:"CellEdit",components:{...ce,VButton:se},provide(){return{formData:{}}},props:{modelValue:{type:[String,Number,Array,Object],default:void 0},item:{type:Object,default:()=>{}},modal:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{localValue:this.$props.modelValue}},methods:{onFiledChange(e){this.$emit("update:modelValue",e)},getComponentName(e){return Ne(e)},getComponentProps(e){return Re(e,{disabled:this.disabled})}}});function en(e,t,a,o,l,s){const n=A("VButton"),i=Te;return r(),c(i,null,{default:p(()=>[e.modal?(r(),c(n,{key:0,type:"modal",text:"查看"},{default:p(()=>[(r(),c(Y(e.getComponentName(e.item.type)),M({modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=u=>e.localValue=u)},e.getComponentProps(e.item),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))]),_:1})):(r(),c(Y(e.getComponentName(e.item.type)),M({key:1,modelValue:e.localValue,"onUpdate:modelValue":t[1]||(t[1]=u=>e.localValue=u)},e.getComponentProps(e.item),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))]),_:1})}const tn=D(Zs,[["render",en]]),an=B({name:"TableStyle",components:{VButton:ze,CellEdit:tn,Warning:ft,...Xs},inject:["dev"],props:{headers:{type:Array,default:e=>[]},dataList:{type:Array,default:e=>[]},props:{type:Object,default:e=>{}},selection:{type:Boolean,default:!1},cellType:{type:Function,default:()=>{}},cellProps:{type:Function,default:()=>{}},cellEvent:{type:Function,default:()=>{}},rowButton:{type:Array,default:e=>[]},makeRowButton:{type:Function,default:()=>{}},loadChildren:{type:Function,default:()=>{}},dragSort:{type:Boolean,default:!1},localSortHandler:{type:Function,default:()=>{}},showRowButton:{type:Boolean,default:!0}},emits:["select-change","sort-change","cell-change","btn-action","mounted","drag-sort"],setup(e,{emit:t}){const a=_("light"),o=_({background:"#eef1f6",color:"#303133"});let l=null,s=null;const n=g=>{o.value=g==="dark"?{background:"#1f2937",color:"#e5e7eb"}:{background:"#eef1f6",color:"#303133"}};Ie(()=>{e.dragSort&&E(),n(a.value),l=na(a),s=be(a,g=>{n(g)},{immediate:!0})}),wt(()=>{l?.(),s?.()});const i=_(0),u=z(()=>{if(e.rowButton.length===1)return;let g=0;for(let w=0;w<e.rowButton?.length;w++){const P=e.rowButton[w];if(P.ignoreWith!==!0)if(P.type==="group")g+=98;else{const ae=P.width||1;g+=(P.text?P?.props?.icon?90:78:65)*ae}}return g}),d=g=>{t("select-change",g)},b=g=>{t("sort-change",g)},m=g=>({sortable:g.sortable?"custom":!1,...g.props}),y=(g,w,P)=>{t("cell-change",{index:g,field:w,value:P})},k=g=>{t("btn-action",g),C.value++},h=_(null),C=_(0),E=()=>{const g=document.querySelector(".el-table__body-wrapper tbody");Ma.create(g,{onEnd(w){t("drag-sort",w)}})},j=_([]);return{rowKey:i,actionWidth:u,handleSelectionChange:d,sortTable:b,getColumnProps:m,cellChange:y,btnAction:k,tabledom:h,rowAction:C,indexs:j,rowClassName:({row:g,rowIndex:w})=>`table-tr-${w}`,headerCellStyle:o}}}),ln={devtool:"{devId: `headers[${index}]`, dev: dev, parent: 2}"},on=["innerHTML"];function sn(e,t,a,o,l,s){const n=ka,i=A("warning"),u=Z,d=ue,b=A("cell-edit"),m=A("v-button"),y=Va,k=Ca;return r(),c(k,M({id:"table",ref:"tabledome",data:e.dataList,load:e.loadChildren,style:{width:"100%"}},e.props,{"header-cell-style":e.headerCellStyle,"row-class-name":e.rowClassName,onSelectionChange:e.handleSelectionChange,onSortChange:e.sortTable}),{empty:p(()=>[x(O(e.props.emptyText||"没有数据"),1)]),default:p(()=>[e.selection?(r(),c(n,{key:0,type:"selection"})):V("",!0),(r(!0),v(T,null,N(e.headers.filter(h=>h.type!=="hidden"),(h,C)=>(r(),c(n,M({key:C+"-table-column",prop:h.field},{ref_for:!0},e.getColumnProps(h)),{header:p(()=>[S("span",ln,[x(O(h.label||h.field)+" ",1),h.info?(r(),c(d,{key:0,effect:"dark",placement:"top-start"},{content:p(()=>[S("span",{innerHTML:h.info},null,8,on)]),default:p(()=>[f(u,null,{default:p(()=>[f(i)]),_:1})]),_:2},1024)):V("",!0)])]),default:p(E=>[h.edit?(r(),c(b,M({key:`${C}-${e.rowKey}`,modelValue:E.row[E.column.property],"onUpdate:modelValue":j=>E.row[E.column.property]=j},{ref_for:!0},{item:h,disabled:h.props&&h.props.disabled},{"onUpdate:modelValue":j=>e.cellChange(E.index_,h.field,j)}),null,16,["modelValue","onUpdate:modelValue"])):(r(),c(Y(e.cellType(h)),M({key:1,ref_for:!0},e.cellProps(h,E)),null,16))]),_:2},1040,["prop"]))),128)),e.showRowButton&&e.rowButton.length>0?(r(),c(n,{key:1,label:"操作",fixed:"right",width:e.actionWidth},{default:p(h=>[(r(),c(m,{key:e.rowAction+"-"+h.$index,buttons:e.makeRowButton(e.rowButton,h.row,h.$index),"prefix-path":"rowButton",onAction:e.btnAction},null,8,["buttons","onAction"]))]),_:1},8,["width"])):V("",!0),f(y)]),_:1},16,["data","load","header-cell-style","row-class-name","onSelectionChange","onSortChange"])}const nn=D(an,[["render",sn]]),Ce=yt,rn=B({name:"VIcon",props:{name:{type:String,required:!0}},setup(e){const t=()=>null;if(e.name===void 0)return t;if(e.name.indexOf("el-")===0){const a=lt(e.name.replace("el-icon-",""),"-"),o=Ce[a];if(!o)return t;const l={height:"1em",width:"1em"};return()=>f(o,{style:l},null)}if(Ce[e.name]){const a=Ce[e.name],o={height:"1em",width:"1em"};return()=>f(a,{style:o},null)}return e.name.indexOf("ra-")===0?()=>f("i",{class:"iconfont "+e.name},null):t}}),un=B({name:"VTable",components:{VIcon:rn,VForm:He,VButton:ze,ExportAddButton:os,TableStyle:nn},provide(){return{dev:this.dev}},inheritAttrs:!1,props:{dev:{type:Boolean,default:!1},headers:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},listApi:{type:String,default:""},infoApi:{type:String,default:""},schemaHandle:{type:Function,default:e=>e},filter:{type:Array,default:()=>[]},batchButton:{type:Array,default:()=>[]},normalButton:{type:Array,default:()=>[]},rowButton:{type:Array,default:()=>[]},showPagination:{type:Boolean,default:!0},showNormalButton:{type:Boolean,default:!0},showBatchButton:{type:Boolean,default:!0},showRowButton:{type:Boolean,default:!0},showFilter:{type:Boolean,default:!0},showSelection:{type:Boolean,default:void 0},selectedNotice:{type:[String,Object],default:""},listIncrease:{type:[Boolean,Object],default:!1},tableProps:{type:Object,default:e=>{}},exportAble:{type:Boolean,default:!1},exportCurrentPageAble:{type:Boolean,default:!1},tabs:{type:Array,default:e=>[]},rowHandler:{type:Function,default:(e,t)=>e},dragSort:{type:[Object,String,Boolean],default:()=>""},syncUrl:{type:Boolean,default:!0}},emits:["cell-change","unshiftList","deleteList","updateList","topList","dragSort","selection"],data(){const e={border:!0,stripe:!0,size:"default",rowKey:"id",lazy:!0,defaultExpandAll:!1,expandRowKeys:[1]};let t="";this.$props.tabs.length>0&&(t=this.$props.tabs[0].value),this.$route&&this.$route.query.tab&&(t=this.$route.query.tab);const a=qe.get("table_filter:"+this.$route?.path),o=Object.assign({},this.$route?this.$route.query:{},a,this.queryParams());Object.keys(o).forEach(n=>{n.indexOf("[]")>-1&&(o[n.replace("[]","")]=o[n],delete o[n])});let l=!1;K(this.$props.dragSort)&&this.$props.dragSort&&(l=!0),X(this.$props.dragSort)&&this.$props.dragSort.sortApi&&(l=!0),me(this.$props.dragSort)&&(l=this.$props.dragSort);const s={...this.$props.tableProps};return s.rowKey==="__random__"&&(s.rowKey=()=>new Date().getTime()+Math.random()),o._sort_by!==void 0&&(s.defaultSort={prop:o._sort_by,order:o._sort_type==="desc"?"descending":"ascending"}),{rowKey:0,formKey:0,tableKey:0,tableDefaultProps:e,filterFormOptions:{inline:!0,labelPosition:"right",labelWidth:0,submitButton:{innerHTML:"查询"},cancelButton:{innerHTML:"重置"}},tableNormalButton:this.$props.normalButton,tableBatchButton:this.$props.batchButton,tableRowButton:this.$props.rowButton,tableHeaders:this.$props.headers.filter(n=>n).filter(n=>n.hidden!==!0),tableFilter:this.$props.filter,tableList:this.$props.list,tableSelectedNotice:this.$props.selectedNotice,tableShowPagination:this.$props.showPagination,tableTableProps:Object.assign({},e,s),selectionRows:[],tableExportAble:this.$props.exportAble,tableExportCurrentPageAble:this.$props.exportCurrentPageAble,tableTabs:this.$props.tabs,tableListApi:this.$props.listApi,dragSortEnable:l,tablePage:Object.assign({ps:o._ps?parseInt(o._ps):20,sizes:[20,100,200],pn:o._pn?parseInt(o._pn):1,total:0},this.$props.tableProps?.page||{}),paginationKey:0,filterForm:this.$props.syncUrl?o:{},loading:!1,sort:null,activeTab:t+"",exporting:!1}},computed:{enableSelection(){return this.showSelection===!0?!0:this.tableBatchButton.length!==0},batchButtonCol(){if(this.tableBatchButton.length===0&&this.tableNormalButton.length===0)return 0;const e=this.tableBatchButton.length;let t=this.tableBatchButton.length+this.tableNormalButton.length;return this.$props.exportCurrentPageAble&&(t+=1),Math.round(e/t*24)},showFilterCard(){return this.tableFilter.length>0},actionWidth(){if(this.tableRowButton.length===1)return;let e=0;return this.tableRowButton.forEach(t=>{e+=t.text?73:60}),e},listIncreaseConf(){return me(this.$props.listIncrease)?this.$props.listIncrease===!1?{state:!1}:{state:!0,type:"append",location:"beforeList"}:this.$props.listIncrease},selectedInfoPosition(){return X(this.tableSelectedNotice)?this.tableSelectedNotice.position:"beforePagination"},selectedInfo(){const e={selectedCount:this.selectionRows.length},t=X(this.tableSelectedNotice)?this.tableSelectedNotice.text:this.tableSelectedNotice,a=t.match(/{([\s\S]*?)}/g);if(!a)return t;const o=a.map(s=>s.replace("{","").replace("}","")),l=this.tableHeaders.map(s=>s.field);for(const s in o){const n=o[s].split("|");if(n.length===1||l.indexOf(n[0])===-1)continue;const i=this.selectionRows.map(u=>u[n[0]]);e[o[s]]=Xt.execute(i,n.slice(1))}return F(t,e)}},beforeCreate(){this.$props.infoApi&&this.$http.request({method:"GET",url:this.$props.infoApi}).then(({data:e})=>{e=this.$props.schemaHandle(e),Object.keys(e).forEach(a=>{a==="tableProps"?this["table"+Ye(a)]=Object.assign({},this.tableDefaultProps,e[a]):this["table"+Ye(a)]=e[a]});let t="";this.tableTabs.length>0&&(t=this.tableTabs[0].value),this.$route&&this.$route.query.tab&&(t=this.$route.query.tab),this.activeTab=t+"",this.load()})},mounted(){this.$nextTick(()=>{!this.$props.infoApi&&this.load()})},methods:{changeTab(e,t){this.activeTab=this.tableTabs[e.index].value+"",e.index,this.load()},resetFilter(){const e=this.queryParams();Object.keys(this.filterForm).forEach(t=>{delete e[t],delete e[t+"[]"]}),Ke(e),this.filterForm={},this.formKey++,this.filterForm,this.load()},cellType(e){let t=e.type||"span";return t=t==="input"?"span":t,`cell-${t}`},cellProps(e,t){let a={data:$.get(t.row,t.column.property),column:e,scope:t};return this.cellType(e)==="cell-sort-index"&&(a.onSortIndexChange=({from:o,to:l})=>{if(o!==l&&this.tableList?.length>0){l>this.tableList.length-1&&(l=this.tableList.length-1),l<=0&&(l=0);const s=this.tableList.splice(o,1)[0];this.tableList.splice(l,0,s),this.tableKey++,setTimeout(()=>{const n=document.getElementsByClassName(`table-tr-${l}`)[0];n.classList.forEach(i=>{}),(l+1)%2===0&&n.classList.toggle("el-table__row--striped"),n.classList.add("table-highlight"),xe("table-highlight"),setTimeout(()=>{n.classList.remove(["table-highlight"]),(l+1)%2===0&&n.classList.toggle("el-table__row--striped")},2e3)},60)}}),a.row=t.row,e.type==="tpl"&&(a.tpl=e.tpl||""),e.cellProps!==void 0&&(a=Object.assign(a,e.cellProps)),a},getAvailableFilter(){const e={};return Object.keys(this.filterForm).length===0&&this.tableFilter?.forEach(t=>{t.value!==void 0&&(e[t.field]=jt(t))}),Object.keys(this.filterForm).map(t=>{this.filterForm[t]!==""&&this.filterForm[t]!==void 0&&(e[t]=this.filterForm[t])}),e},searchAction(){const e=this.getAvailableFilter();if(Object.keys(e).length===0){this.$message({message:"请填写筛选条件",type:"warning"});return}this.load({resetPage:!0})},load(e={},t={}){if(!this.tableListApi)return;this.loading=!0,e.resetPage!==void 0&&e.resetPage!==!1&&(this.tablePage.pn=1);const a=this.getAvailableFilter(),o=this.showPagination?{_pn:this.tablePage.pn,_ps:this.tablePage.ps}:{},l=Object.assign({},a,o,this.sort,t,this.$route?this.$route.params:{}),s=$.cloneDeep(this.tableTabs)?.map(n=>(n.value=n.value+"",n));if(this.activeTab){const n=$.findIndex(s,{value:this.activeTab});this.activeTab,n>-1&&(l[this.tableTabs[n].field]=this.activeTab)}this.syncParamsToUrl(l),this.$http.request({type:"GET",url:this.tableListApi,params:l}).then(({data:n})=>(this.tableList=(n.list||[]).map(this.rowHandler),this.tablePage=Object.assign(this.tablePage,n.page||{}),this.loading=!1,this.tableKey++,l))},syncParamsToUrl(e){if(!this.syncUrl)return;$.cloneDeep(this.queryParams()),$.cloneDeep(e);const t=$.merge({},$.cloneDeep(e)),a={_pn:1,_ps:20};Object.keys(a).forEach(o=>{t[o]===a[o]&&delete t[o]}),qe.set("table_filter:"+this.$route.path,t,86400*7),Ke(t)},handleSelectionChange(e){this.selectionRows=e,this.$emit("selection",e)},batchButtonPreCheck(){return this.selectionRows.length===0?(this.$message({message:"请勾选相应记录",type:"warning"}),!1):!0},batchMetaData(e){const t=[];return this.selectionRows.forEach(a=>{a.id!==void 0&&t.push(a.id)}),{ids:t,_selection:this.selectionRows,_query:this.queryParams()}},batchDynamicExtra(e){const t=[],a={};if(e&&e.batchApiParamsKey&&e.batchApiParamsKey.forEach(s=>{a[s]=[]}),this.selectionRows.forEach(s=>{s.id!==void 0&&t.push(s.id),Object.keys(a).forEach(n=>{s[n]!==void 0&&a[n].push(s[n])})}),t.length===0)return this.$message({message:"列表记录缺少主键 id",type:"warning"}),{};const o=t.join(","),l={id:o,ids:o};return Object.keys(a).forEach(s=>{l[s]=a[s].join(",")}),e=e||{},e.data=e.data||{},e.data._selected=this.selectionRows,e.url!==void 0&&(e.params=e.params||{},Object.keys(a).forEach(s=>{e.params[s]=a[s].join(",")}),e.url.indexOf("{id}")===-1&&(e.params.id=o),Qt(e.url)&&(e.url=F(e.url,l))),e},batchBtnAction(){this.load()},pssChange(e){this.tablePage.pn=1,this.tablePage.ps=e,this.paginationKey+=1,this.load()},pnChange(e){if(e-this.tablePage.pn>100){this.$message({message:"禁止大跨度翻页",type:"error"}),this.paginationKey+=1;return}this.tablePage.pn=e,this.load({resetPage:!1})},isArray(e){return I(e)},makeBatchButton(e){return e.map(t=>{if(I(t))t=this.makeBatchButton(t);else if(t["pre-check"]=this.batchButtonPreCheck,t["dynamic-extra"]=this.batchDynamicExtra,t["meta-data"]=this.batchMetaData,t?.extra?.actionHandler)switch(t?.extra?.actionHandler){case"@topList":t.extra.actionHandler=()=>{this.moveSelectedToTop()};break;case"@deleteList":t.extra.actionHandler=()=>{this.deleteSelected()};break}return t})},queryParams(){return ot(location.hash)},queryString(){const e=location.hash.indexOf("?");return e===-1?"":location.hash.substring(e+1)},makeNormalButton(e){const t=this.queryParams();return e.filter(a=>{if(a.when){let o=a.when;return I(a.when[0])||(o=[a.when]),oe(t,o)}return!0}).map(a=>{if(I(a))a=this.makeNormalButton(a);else if(a["meta-data"]=()=>({...this.queryParams(),_query:this.queryString(),tableList:this.tableList}),a?.extra?.initQueryParams===!1&&(a["meta-data"]={}),a?.extra?.actionHandler)switch(a?.extra?.actionHandler){case"@unshiftList":a.extra.actionHandler=o=>{const l=H(a.extra?.parseFormData)?a.extra.parseFormData(o):o;l&&(this.tableList?.unshift(l),this.$emit("unshiftList",o))};break}return a})},fullPath(){return{route_full_path:encodeURIComponent(location.hash.replace("#",""))}},makeRowButton(e,t,a){const o=[];return $.cloneDeep(e.filter(l=>!!l)).forEach(l=>{l.type==="group"?o.push(l.subButton):o.push(l)}),o.filter(l=>{if(l.when){let s=l.when;return I(l.when[0])||(s=[l.when]),oe(t,s)}return!0}).map(l=>{if(I(l))l=this.makeRowButton(l,t);else{const s=l.metaData||{};if(l["inject-data"]=()=>$.merge(this.queryParams(),s),l["meta-data"]=()=>{const n=this.fullPath();return{...this.queryParams(),...t,...n,...s}},l?.extra?.initQueryParams===!1&&(l["meta-data"]={...t,...s}),l?.extra?.actionHandler)switch(l?.extra?.actionHandler){case"@updateList":l.extra.actionHandler=n=>{this.tableList[a]=$.merge(this.tableList[a],n),this.$emit("updateList",n,a)};break;case"@deleteList":l.extra.actionHandler=()=>{this.tableList.splice(a,1),this.$emit("deleteList",a)};break;case"@unshiftList":l.extra.actionHandler=n=>{this.tableList?.unshift(n),this.$emit("unshiftList",n,a)};break;case"@topList":l.extra.actionHandler=n=>{this.moveItemToTop(a),this.$emit("topList",n,a)};break}}return l})},moveItemToTop(e){const t=this.tableList?.splice(e,1);this.tableList.unshift(t[0])},moveSelectedToTop(){for(let e=0;e<this.selectionRows.length;e++){const t=this.selectionRows[e],a=this.tableList.findIndex(o=>o.id===t.id);a>-1&&this.moveItemToTop(a)}},deleteSelected(){for(let e=0;e<this.selectionRows.length;e++){const t=this.selectionRows[e],a=this.tableList.findIndex(o=>o.id===t.id);a>-1&&this.tableList?.splice(a,1)}},listIncreaseRecord(){const e={};Object.keys(this.tableHeaders).forEach(t=>{e[t.field]=void 0}),this.listIncreaseConf.type==="append"?this.tableList.push(e):this.listIncreaseConf.type==="unshift"?this.tableList.unshift(e):console.warn("unknown listIncrease type"),this.rowKey++},cellChange(e,t,a){this.$emit("cell-change",{index:e,field:t,value:a})},getColumnProps(e){return{sortable:e.sortable?"custom":!1}},sortTable({column:e,order:t,prop:a}){if(!(t&&a)){this.sort=null;return}this.sort={_sort_by:a,_sort_type:t==="descending"?"desc":"asc"};const o={prop:a,order:t},l=this.tableTableProps.defaultSort;JSON.stringify(l)!==JSON.stringify(o)&&(this.tableTableProps.defaultSort=o,this.load())},loadChildren(e,t,a){this.$http.request({type:"GET",url:this.tableListApi.replace("/list","/children"),params:{pid:e.id}}).then(({data:o})=>{a(o||[])})},btnAction(){this.load()},getExportInfo(){return{listApi:this.tableListApi,params:this.filterForm,header:$.cloneDeep(this.tableHeaders),name:Qo(this.$route?this.$route.matched:[],!1)}},exportCurrentTable(){this.exporting=!0;const e=[],t=[],a={};this.tableHeaders.forEach(s=>{e.push(s.label),a[s.field]=s,t.push(s.field)});const o=[];(this.tableList||[]).forEach(s=>{const n=[];t.forEach(i=>{let u=s[i];if(u===void 0){n.push("");return}const d=a[i];switch(d.type){case"enum":{const b=$.findIndex(d.options,{value:u}),m=d.options?d.options[b]:!1;u=m?m.label:u;break}}n.push(u)}),o.push(n)});const l=document.title||new Date().getTime();Rt(e,o,l,!1),this.exporting=!1},dragSortHandle(e){if(!this.dragSortEnable)return;this.tableTableProps.defaultSort={};const{newIndex:t,oldIndex:a}=e;let o={};this.tableList?.length>0&&(o=this.tableList.splice(a,1)[0],this.tableList.splice(t,0,o),this.tableKey++);let l="",s=!1,n="此操作将会改变数据顺序, {oldIndex} => {newIndex}, 是否确认此操作?";if(K(this.$props.dragSort)&&this.$props.dragSort&&(l=this.$props.dragSort),X(this.$props.dragSort)&&this.$props.dragSort.sortApi&&(l=this.$props.dragSort.sortApi,s=this.$props.dragSort.confirm===!0,this.$props.dragSort.confirmMsg&&(n=this.$props.dragSort.confirmMsg),this.$props.dragSort),!l)return;const i=[];if(this.tableList?.forEach(d=>{d.id!==void 0&&i.push(d.id)}),i.length===0)return;const u=()=>this.$http.request({method:"POST",url:l,data:{ids:i.join(",")}}).then(d=>{this.$message({type:"success",message:"排序更新成功, 数据将刷新"}),this.$emit("dragSort"),this.load()});s?ht.confirm(F(n,{...o,oldIndex:a+1,newIndex:t+1}),"Warning",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{u()}).catch(()=>{const d=this.tableList.splice(t,1)[0];this.tableList.splice(a,0,d),this.tableKey++,Ee({type:"info",message:"已取消"})}):u()},getListData(){return this.tableList},localSortHandler(e,t){}}}),dn={key:0,class:"selected-info"},pn=["innerHTML"],cn={key:0,class:"selected-info"},hn=["innerHTML"],mn={key:0,class:"table-pagination"};function fn(e,t,a,o,l,s){const n=A("v-form"),i=ut,u=A("v-button"),d=W,b=A("export-add-button"),m=q,y=G,k=A("v-icon"),h=A("table-style"),C=dt,E=ct,j=va,g=pt;return r(),v(T,null,[e.showFilter&&e.showFilterCard?(r(),c(i,{key:0,shadow:"never",class:"table-filter"},{default:p(()=>[ee(e.$slots,"filter",{},()=>[e.tableFilter.length>0?(r(),c(n,{key:e.formKey,ref:"filter",modelValue:e.filterForm,"onUpdate:modelValue":t[0]||(t[0]=w=>e.filterForm=w),dev:e.dev,class:"filter-form","prefix-path":"filter",options:e.filterFormOptions,"form-items":e.tableFilter,"init-query-params":e.syncUrl,onSubmit:e.searchAction,onReset:e.resetFilter},null,8,["modelValue","dev","options","form-items","init-query-params","onSubmit","onReset"])):V("",!0)],!0)]),_:3})):V("",!0),ee(e.$slots,"action",{},()=>[f(y,{gutter:20,style:{"margin-bottom":"20px"}},{default:p(()=>[e.showBatchButton?(r(),c(d,{key:0,span:e.batchButtonCol},{default:p(()=>[f(u,{buttons:e.makeBatchButton(e.tableBatchButton),"prefix-path":"batchButton",onAction:e.batchBtnAction},null,8,["buttons","onAction"]),e.tableBatchButton.length>0&&e.selectedInfoPosition==="afterBatchButton"?(r(),v("div",dn,[S("span",{innerHTML:e.selectedInfo},null,8,pn)])):V("",!0)]),_:1},8,["span"])):V("",!0),e.showNormalButton?(r(),c(d,{key:1,span:24-e.batchButtonCol,class:"normal-button"},{default:p(()=>[f(u,{buttons:e.makeNormalButton(e.tableNormalButton),"prefix-path":"normalButton",onAction:e.load},null,8,["buttons","onAction"]),e.tableExportAble?(r(),c(b,{key:0,"get-info":e.getExportInfo},null,8,["get-info"])):V("",!0),e.tableExportCurrentPageAble?(r(),c(m,{key:1,type:"primary",loading:e.exporting,onClick:e.exportCurrentTable},{default:p(()=>[...t[3]||(t[3]=[x("导出",-1)])]),_:1},8,["loading","onClick"])):V("",!0)]),_:1},8,["span"])):V("",!0)]),_:1})],!0),ee(e.$slots,"before_table",{},void 0,!0),e.tableTabs.length>0?(r(),c(E,{key:1,modelValue:e.activeTab,"onUpdate:modelValue":t[1]||(t[1]=w=>e.activeTab=w),type:"card",onTabClick:e.changeTab},{default:p(()=>[(r(!0),v(T,null,N(e.tableTabs,(w,P)=>(r(),c(C,{key:P+"-pane",name:w.value+"",lazy:!0},{label:p(()=>[S("span",null,[f(k,{name:w.icon||""},null,8,["name"]),x(O(w.label),1)])]),default:p(()=>[ee(e.$slots,"table",{},()=>[Q((r(),c(h,{ref_for:!0,ref:"table",key:e.tableKey,headers:e.tableHeaders,"data-list":e.tableList,"drag-sort":e.dragSortEnable,props:e.tableTableProps,selection:e.enableSelection,"cell-type":e.cellType,"cell-props":e.cellProps,"row-button":e.tableRowButton,"show-row-button":e.showRowButton,"make-row-button":e.makeRowButton,"load-children":e.loadChildren,"local-sort-handler":e.localSortHandler,onSelectChange:e.handleSelectionChange,onSortChange:e.sortTable,onCellChange:e.cellChange,onBtnAction:e.btnAction,onMounted:e.load,onDragSort:e.dragSortHandle},null,8,["headers","data-list","drag-sort","props","selection","cell-type","cell-props","row-button","show-row-button","make-row-button","load-children","local-sort-handler","onSelectChange","onSortChange","onCellChange","onBtnAction","onMounted","onDragSort"])),[[g,e.loading]])],!0)]),_:2},1032,["name"]))),128))]),_:3},8,["modelValue","onTabClick"])):ee(e.$slots,"table",{key:2},()=>[Q((r(),c(h,{ref:"table",key:e.tableKey,headers:e.tableHeaders,"data-list":e.tableList,"drag-sort":e.dragSortEnable,props:e.tableTableProps,selection:e.enableSelection,"cell-type":e.cellType,"cell-props":e.cellProps,"row-button":e.tableRowButton,"show-row-button":e.showRowButton,"make-row-button":e.makeRowButton,"load-children":e.loadChildren,"local-sort-handler":e.localSortHandler,onSelectChange:e.handleSelectionChange,onSortChange:e.sortTable,onCellChange:e.cellChange,onBtnAction:e.btnAction,onDragSort:e.dragSortHandle},null,8,["headers","data-list","drag-sort","props","selection","cell-type","cell-props","row-button","show-row-button","make-row-button","load-children","local-sort-handler","onSelectChange","onSortChange","onCellChange","onBtnAction","onDragSort"])),[[g,e.loading]])],!0),e.listIncreaseConf.state&&e.listIncreaseConf.location==="afterList"?(r(),c(m,{key:3,class:"list-incr-button",onClick:e.listIncreaseRecord},{default:p(()=>[...t[4]||(t[4]=[x("添加",-1)])]),_:1},8,["onClick"])):V("",!0),f(y,{style:{display:"flex"}},{default:p(()=>[f(d,{span:12,style:{"min-height":"15px"}},{default:p(()=>[e.tableBatchButton.length>0&&e.selectedInfoPosition==="beforePagination"?(r(),v("div",cn,[S("span",{innerHTML:e.selectedInfo},null,8,hn)])):V("",!0)]),_:1}),f(d,{span:12},{default:p(()=>[ee(e.$slots,"page",{},()=>[e.tableShowPagination?(r(),v("div",mn,[(r(),c(j,{key:e.paginationKey,background:"",layout:"total, sizes, prev, pager, next","page-size":e.tablePage.ps,"page-sizes":e.tablePage.sizes,"current-page":e.tablePage.pn,total:e.tablePage.total,onSizeChange:e.pssChange,onCurrentChange:t[2]||(t[2]=w=>e.pnChange(w))},null,8,["page-size","page-sizes","current-page","total","onSizeChange"]))])):V("",!0)],!0)]),_:3})]),_:3})],64)}const zt=D(un,[["render",fn],["__scopeId","data-v-15144d83"]]),qt=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"})),bn=Object.freeze(Object.defineProperty({__proto__:null,VTable:zt},Symbol.toStringTag,{value:"Module"})),yn=Object.freeze(Object.defineProperty({__proto__:null,RegComponents:Ro,VBtn:ze,VButton:se,VButtonGroup:Nt},Symbol.toStringTag,{value:"Module"}));({...Eo,...bn,...yn});export{Co as I,Ht as J,ze as W,zt as X,He as Y,Ms as a,rn as v};
